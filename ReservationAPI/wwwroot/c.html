<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservation API Explorer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1, h2, h3 {
            color: #333;
        }

        .section {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }

        .method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin-right: 10px;
        }

        .get {
            background-color: #61affe;
            color: white;
        }

        .post {
            background-color: #49cc90;
            color: white;
        }

        .put {
            background-color: #fca130;
            color: white;
        }

        .delete {
            background-color: #f93e3e;
            color: white;
        }

        .path {
            font-family: monospace;
            font-size: 16px;
        }

        .description {
            margin: 10px 0;
            color: #555;
        }

        .form-group {
            margin-bottom: 10px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

            button:hover {
                background-color: #45a049;
            }

        .response {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f5f5f5;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }

        .token-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }

        .tab {
            display: inline-block;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #eee;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }

            .tab.active {
                background-color: #f9f9f9;
                border: 1px solid #ddd;
                border-bottom: 1px solid #f9f9f9;
            }

        .tab-content {
            display: none;
        }

            .tab-content.active {
                display: block;
            }
    </style>
</head>
<body>
    <div class="container">
        <h1>Reservation API Explorer</h1>

        <!-- Authentication Section -->
        <div class="section">
            <h2>Authentication</h2>

            <div class="tabs">
                <div class="tab active" data-tab="login">Login</div>
                <div class="tab" data-tab="register">Register</div>
                <div class="tab" data-tab="refresh">Refresh Token</div>
            </div>

            <!-- Login Tab -->
            <div id="login-tab" class="tab-content active">
                <div class="form-group">
                    <label for="auth-email">Email:</label>
                    <input type="email" id="auth-email" placeholder="Your email">
                </div>
                <div class="form-group">
                    <label for="auth-password">Password:</label>
                    <input type="password" id="auth-password" placeholder="Your password">
                </div>
                <div class="form-group">
                    <label for="auth-role">Role:</label>
                    <select id="auth-role">
                        <option value="1">User</option>
                        <option value="2">Admin</option>
                    </select>
                </div>
                <button id="login-btn">Login</button>
            </div>

            <!-- Register Tab -->
            <div id="register-tab" class="tab-content">
                <div class="form-group">
                    <label for="reg-email">Email:</label>
                    <input type="email" id="reg-email" placeholder="Your email">
                </div>
                <div class="form-group">
                    <label for="reg-password">Password:</label>
                    <input type="password" id="reg-password" placeholder="Your password">
                </div>
                <div class="form-group">
                    <label for="reg-role">Role:</label>
                    <select id="reg-role">
                        <option value="1">User</option>
                        <option value="2">Admin</option>
                    </select>
                </div>
                <button id="register-btn">Register</button>
            </div>

            <!-- Refresh Token Tab -->
            <div id="refresh-tab" class="tab-content">
                <p>Refresh your access token using the refresh token.</p>
                <button id="refresh-btn">Refresh Token</button>
            </div>

            <div id="auth-status" style="margin-top: 10px;"></div>
            <div class="token-info" id="token-info" style="display: none;">
                <strong>Token:</strong> <span id="token-display"></span><br>
                <strong>Refresh Token:</strong> <span id="refresh-token-display"></span>
            </div>
        </div>

        <!-- API Sections -->
        <div class="section">
            <h2>API Endpoints</h2>

            <div class="tabs">
                <div class="tab active" data-tab="payments">Payments</div>
                <div class="tab" data-tab="users">Users</div>
                <div class="tab" data-tab="reservations">Reservations</div>
                <div class="tab" data-tab="resources">Resources</div>
                <div class="tab" data-tab="reviews">Reviews</div>
                <div class="tab" data-tab="timeslots">TimeSlots</div>
                <div class="tab" data-tab="promotions">Promotions</div>
            </div>

            <!-- Payments Tab -->
            <div id="payments-tab" class="tab-content active">
                <h3>Payments</h3>
                <button id="get-payments-btn">Get All Payments</button>
                <button id="create-payment-btn">Create Payment</button>
                <div class="form-group" id="payment-form" style="display: none;">
                    <label for="payment-user-id">User ID:</label>
                    <input type="number" id="payment-user-id">
                    <label for="payment-type">Type:</label>
                    <select id="payment-type">
                        <option value="0">Type 0</option>
                        <option value="1">Type 1</option>
                        <option value="2">Type 2</option>
                        <option value="3">Type 3</option>
                        <option value="4">Type 4</option>
                    </select>
                    <button id="submit-payment-btn">Submit</button>
                </div>
                <div class="response" id="payments-response"></div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <h3>Users</h3>
                <button id="get-users-btn">Get All Users</button>
                <button id="create-user-btn">Create User</button>
                <div class="form-group" id="user-form" style="display: none;">
                    <label for="user-email">Email:</label>
                    <input type="email" id="user-email">
                    <button id="submit-user-btn">Submit</button>
                </div>
                <div class="response" id="users-response"></div>
            </div>

            <!-- Add similar tabs for other endpoints -->
            <!-- Reservations, Resources, Reviews, TimeSlots, Promotions -->

        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5178/api';
        let authToken = null;
        let refreshToken = null;

        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab
                tab.classList.add('active');
                const tabName = tab.getAttribute('data-tab');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });

        // Token management
        function loadTokens() {
            authToken = sessionStorage.getItem('authToken');
            refreshToken = sessionStorage.getItem('refreshToken');

            if (authToken) {
                updateTokenDisplay();
            }
        }

        function saveTokens(token, refresh) {
            authToken = token;
            refreshToken = refresh;

            sessionStorage.setItem('authToken', token);
            if (refresh) {
                sessionStorage.setItem('refreshToken', refresh);
            }

            updateTokenDisplay();
        }

        function clearTokens() {
            authToken = null;
            refreshToken = null;
            sessionStorage.removeItem('authToken');
            sessionStorage.removeItem('refreshToken');
            document.getElementById('token-info').style.display = 'none';
        }

        function updateTokenDisplay() {
            document.getElementById('token-display').textContent = authToken ? authToken.substring(0, 50) + '...' : '';
            document.getElementById('refresh-token-display').textContent = refreshToken || 'N/A';
            document.getElementById('token-info').style.display = authToken ? 'block' : 'none';
        }

        // Authentication functions
        document.getElementById('login-btn').addEventListener('click', async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const roleId = parseInt(document.getElementById('auth-role').value);

            try {
                const response = await fetch(`${API_BASE}/Auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, roleId })
                });

                if (!response.ok) throw new Error('Login failed');

                const data = await response.json();
                saveTokens(data.token, data.refreshToken);
                showStatus('Login successful!', 'green');
            } catch (error) {
                showStatus('Error: ' + error.message, 'red');
            }
        });

        document.getElementById('register-btn').addEventListener('click', async () => {
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const roleId = parseInt(document.getElementById('reg-role').value);

            try {
                const response = await fetch(`${API_BASE}/Auth/Register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, roleId })
                });

                if (!response.ok) throw new Error('Registration failed');

                showStatus('Registration successful! Please login.', 'green');
            } catch (error) {
                showStatus('Error: ' + error.message, 'red');
            }
        });

        document.getElementById('refresh-btn').addEventListener('click', async () => {
            if (!refreshToken) {
                showStatus('No refresh token found', 'red');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Auth/refresh`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ refreshToken })
                });

                if (!response.ok) throw new Error('Refresh failed');

                const data = await response.json();
                saveTokens(data.token, data.refreshToken);
                showStatus('Token refreshed', 'green');
            } catch (error) {
                showStatus('Error: ' + error.message, 'red');
            }
        });

        // Payment functions
        document.getElementById('get-payments-btn').addEventListener('click', async () => {
            if (!checkAuth()) return;

            try {
                const response = await fetch(`${API_BASE}/Payment`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                displayResponse('payments-response', data);
            } catch (error) {
                displayResponse('payments-response', `Error: ${error.message}`);
            }
        });

        document.getElementById('create-payment-btn').addEventListener('click', () => {
            document.getElementById('payment-form').style.display = 'block';
        });

        document.getElementById('submit-payment-btn').addEventListener('click', async () => {
            if (!checkAuth()) return;

            const userId = parseInt(document.getElementById('payment-user-id').value);
            const type = parseInt(document.getElementById('payment-type').value);

            try {
                const response = await fetch(`${API_BASE}/Payment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ userId, type })
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                displayResponse('payments-response', data);
                document.getElementById('payment-form').style.display = 'none';
            } catch (error) {
                displayResponse('payments-response', `Error: ${error.message}`);
            }
        });

        // User functions
        document.getElementById('get-users-btn').addEventListener('click', async () => {
            if (!checkAuth()) return;

            try {
                const response = await fetch(`${API_BASE}/User`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                displayResponse('users-response', data);
            } catch (error) {
                displayResponse('users-response', `Error: ${error.message}`);
            }
        });

        document.getElementById('create-user-btn').addEventListener('click', () => {
            document.getElementById('user-form').style.display = 'block';
        });

        document.getElementById('submit-user-btn').addEventListener('click', async () => {
            if (!checkAuth()) return;

            const email = document.getElementById('user-email').value;

            try {
                const response = await fetch(`${API_BASE}/User`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ email })
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                displayResponse('users-response', data);
                document.getElementById('user-form').style.display = 'none';
            } catch (error) {
                displayResponse('users-response', `Error: ${error.message}`);
            }
        });

        // Helper functions
        function checkAuth() {
            if (!authToken) {
                showStatus('Please login first', 'red');
                return false;
            }
            return true;
        }

        function showStatus(message, color) {
            const statusEl = document.getElementById('auth-status');
            statusEl.textContent = message;
            statusEl.style.color = color;
        }

        function displayResponse(elementId, data) {
            const responseEl = document.getElementById(elementId);
            responseEl.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
        }

        // Initialize
        loadTokens();
    </script>
</body>
</html>