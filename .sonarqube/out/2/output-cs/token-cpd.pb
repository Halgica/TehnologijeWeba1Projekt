î	
ZC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Settings\JwtSettings.cs
	namespace 	
ReservationAPI
 
. 
Settings !
{ 
public 

class 
JwtSettings 
{ 
public 
string 
Secret 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Issuer 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Audience 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
int 
ExpiryMinutes  
{! "
get# &
;& '
set( +
;+ ,
}- .
}		 
}

 Ω#
ZC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Services\AuthService.cs
	namespace

 	
ReservationAPI


 
.

 
Services

 !
{ 
public 

class 
AuthService 
{ 
private 
readonly 
IConfiguration '
_config( /
;/ 0
private 
readonly 
TW1DbContext %

_dbContext& 0
;0 1
public 
AuthService 
( 
IConfiguration )
config* 0
,0 1
TW1DbContext2 >
context? F
)F G
{ 	
_config 
= 
config 
; 

_dbContext 
= 
context  
;  !
} 	
public 
string 
GenerateJwtToken &
(& '
AuthUser' /
user0 4
)4 5
{ 	
var 
jwtSettings 
= 
_config %
.% &

GetSection& 0
(0 1
$str1 >
)> ?
.? @
Get@ C
<C D
JwtSettingsD O
>O P
(P Q
)Q R
;R S
var 
claims 
= 
new 
[ 
] 
{ 
new 
Claim 
( #
JwtRegisteredClaimNames 1
.1 2
Sub2 5
,5 6
user7 ;
.; <
Id< >
.> ?
ToString? G
(G H
)H I
)I J
,J K
new 
Claim 
( #
JwtRegisteredClaimNames 1
.1 2
Email2 7
,7 8
user9 =
.= >
Email> C
)C D
,D E
new 
Claim 
( 

ClaimTypes $
.$ %
Role% )
,) *
user+ /
./ 0
Role0 4
.4 5
Name5 9
)9 :
}   
;   
var!! 
key!! 
=!! 
new!!  
SymmetricSecurityKey!! .
(!!. /
Encoding!!/ 7
.!!7 8
UTF8!!8 <
.!!< =
GetBytes!!= E
(!!E F
jwtSettings!!F Q
.!!Q R
Secret!!R X
)!!X Y
)!!Y Z
;!!Z [
var"" 
creds"" 
="" 
new"" 
SigningCredentials"" .
("". /
key""/ 2
,""2 3
SecurityAlgorithms""4 F
.""F G

HmacSha256""G Q
)""Q R
;""R S
var$$ 
token$$ 
=$$ 
new$$ 
JwtSecurityToken$$ ,
($$, -
issuer%% 
:%% 
jwtSettings%% #
.%%# $
Issuer%%$ *
,%%* +
audience&& 
:&& 
jwtSettings&& %
.&&% &
Audience&&& .
,&&. /
claims'' 
:'' 
claims'' 
,'' 
expires(( 
:(( 
DateTime(( !
.((! "
UtcNow((" (
.((( )

AddMinutes(() 3
(((3 4
jwtSettings((4 ?
.((? @
ExpiryMinutes((@ M
)((M N
,((N O
signingCredentials)) "
:))" #
creds))$ )
)** 
;** 
return++ 
new++ #
JwtSecurityTokenHandler++ .
(++. /
)++/ 0
.++0 1

WriteToken++1 ;
(++; <
token++< A
)++A B
;++B C
},, 	
public-- 
string--  
GenerateRefreshToken-- *
(--* +
AuthUser--+ 3
user--4 8
)--8 9
{.. 	
var// 
refreshToken// 
=// 
Guid// #
.//# $
NewGuid//$ +
(//+ ,
)//, -
.//- .
ToString//. 6
(//6 7
)//7 8
;//8 9
user00 
.00 
RefreshToken00 
=00 
refreshToken00  ,
;00, -

_dbContext22 
.22 
Update22 
(22 
user22 "
)22" #
;22# $

_dbContext33 
.33 
SaveChanges33 "
(33" #
)33# $
;33$ %
return55 
refreshToken55 
;55  
}66 	
}77 
}88 õY
MC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Program.cs
	namespace 	
ReservationAPI
 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
var 
builder 
= 
WebApplication (
.( )
CreateBuilder) 6
(6 7
args7 ;
); <
;< =
builder 
. 
Host 
. 

UseSerilog #
(# $
($ %
context% ,
,, -
services. 6
,6 7
configuration8 E
)E F
=>G I
configuration 
. 
ReadFrom &
.& '
Configuration' 4
(4 5
context5 <
.< =
Configuration= J
)J K
)K L
;L M
builder 
. 
Services 
. 
	Configure &
<& '
JwtSettings' 2
>2 3
(3 4
builder4 ;
.; <
Configuration< I
.I J

GetSectionJ T
(T U
$strU b
)b c
)c d
;d e
builder 
. 
Services 
. 
AddAuthentication .
(. /
options/ 6
=>7 9
{ 
options 
. %
DefaultAuthenticateScheme 1
=2 3
JwtBearerDefaults4 E
.E F 
AuthenticationSchemeF Z
;Z [
options 
. "
DefaultChallengeScheme .
=/ 0
JwtBearerDefaults1 B
.B C 
AuthenticationSchemeC W
;W X
} 
) 
.   
AddJwtBearer   
(   
options   !
=>  " $
{!! 
var"" 
jwtSettings"" 
=""  !
builder""" )
."") *
Configuration""* 7
.""7 8

GetSection""8 B
(""B C
$str""C P
)""P Q
.""Q R
Get""R U
<""U V
JwtSettings""V a
>""a b
(""b c
)""c d
;""d e
options## 
.## %
TokenValidationParameters## 1
=##2 3
new##4 7%
TokenValidationParameters##8 Q
{$$ 
ValidateIssuer%% "
=%%# $
true%%% )
,%%) *
ValidateAudience&& $
=&&% &
true&&' +
,&&+ ,
ValidateLifetime'' $
=''% &
true''' +
,''+ ,$
ValidateIssuerSigningKey(( ,
=((- .
true((/ 3
,((3 4
ValidIssuer)) 
=))  !
jwtSettings))" -
.))- .
Issuer)). 4
,))4 5
ValidAudience** !
=**" #
jwtSettings**$ /
.**/ 0
Audience**0 8
,**8 9
IssuerSigningKey++ $
=++% &
new++' * 
SymmetricSecurityKey+++ ?
(++? @
Encoding++@ H
.++H I
UTF8++I M
.++M N
GetBytes++N V
(++V W
jwtSettings++W b
.++b c
Secret++c i
)++i j
)++j k
},, 
;,, 
}-- 
)-- 
;-- 
builder// 
.// 
Services// 
.// 
AddSwaggerGen// *
(//* +
c//+ ,
=>//- /
{00 
c11 
.11 !
AddSecurityDefinition11 '
(11' (
$str11( 0
,110 1
new112 5!
OpenApiSecurityScheme116 K
{22 
Description33 
=33  !
$str33" U
,33U V
Name44 
=44 
$str44 *
,44* +
In55 
=55 
ParameterLocation55 *
.55* +
Header55+ 1
,551 2
Type66 
=66 
SecuritySchemeType66 -
.66- .
Http66. 2
,662 3
Scheme77 
=77 
$str77 %
,77% &
BearerFormat88  
=88! "
$str88# (
}99 
)99 
;99 
c;; 
.;; "
AddSecurityRequirement;; (
(;;( )
new;;) ,&
OpenApiSecurityRequirement;;- G
{<< 	
{== 	
new>> !
OpenApiSecurityScheme>> %
{?? 
	Reference@@ 
=@@ 
new@@ 
OpenApiReference@@  0
{AA 
TypeBB 
=BB 
ReferenceTypeBB (
.BB( )
SecuritySchemeBB) 7
,BB7 8
IdCC 
=CC 
$strCC !
}DD 
}EE 
,EE 
ArrayFF 
.FF 
EmptyFF 
<FF 
stringFF 
>FF 
(FF  
)FF  !
}GG 	
}HH 	
)HH	 

;HH
 
}II 
)II 
;II 
builderKK 
.KK 
ServicesKK 
.KK 
AddAutoMapperKK *
(KK* +
typeofKK+ 1
(KK1 2
ProgramKK2 9
)KK9 :
)KK: ;
;KK; <
builderLL 
.LL 
ServicesLL 
.LL 
AddControllersLL +
(LL+ ,
)LL, -
;LL- .
builderMM 
.MM 
ServicesMM 
.MM #
AddEndpointsApiExplorerMM 4
(MM4 5
)MM5 6
;MM6 7
builderNN 
.NN 
ServicesNN 
.NN 
AddSwaggerGenNN *
(NN* +
)NN+ ,
;NN, -
builderPP 
.PP 
ServicesPP 
.PP 
	AddScopedPP &
<PP& '
IUserRepositoryPP' 6
,PP6 7
UserRepositoryPP8 F
>PPF G
(PPG H
)PPH I
;PPI J
builderQQ 
.QQ 
ServicesQQ 
.QQ 
	AddScopedQQ &
<QQ& '
IResourceRepositoryQQ' :
,QQ: ;
ResourceRepositoryQQ< N
>QQN O
(QQO P
)QQP Q
;QQQ R
builderRR 
.RR 
ServicesRR 
.RR 
	AddScopedRR &
<RR& '"
IReservationRepositoryRR' =
,RR= >!
ReservationRepositoryRR? T
>RRT U
(RRU V
)RRV W
;RRW X
builderSS 
.SS 
ServicesSS 
.SS 
	AddScopedSS &
<SS& '
IPaymentRepositorySS' 9
,SS9 :
PaymentRepositorySS; L
>SSL M
(SSM N
)SSN O
;SSO P
builderTT 
.TT 
ServicesTT 
.TT 
	AddScopedTT &
<TT& ' 
IPromotionRepositoryTT' ;
,TT; <
PromotionRepositoryTT= P
>TTP Q
(TTQ R
)TTR S
;TTS T
builderUU 
.UU 
ServicesUU 
.UU 
	AddScopedUU &
<UU& '
IReviewRepositoryUU' 8
,UU8 9
ReviewRepositoryUU: J
>UUJ K
(UUK L
)UUL M
;UUM N
builderVV 
.VV 
ServicesVV 
.VV 
	AddScopedVV &
<VV& '
IRoleRepositoryVV' 6
,VV6 7
RoleRepositoryVV8 F
>VVF G
(VVG H
)VVH I
;VVI J
builderWW 
.WW 
ServicesWW 
.WW 
	AddScopedWW &
<WW& '
ITimeSlotRepositoryWW' :
,WW: ;
TimeSlotRepositoryWW< N
>WWN O
(WWO P
)WWP Q
;WWQ R
builderXX 
.XX 
ServicesXX 
.XX 
	AddScopedXX &
<XX& '
AuthServiceXX' 2
>XX2 3
(XX3 4
)XX4 5
;XX5 6
builderZZ 
.ZZ 
ServicesZZ 
.ZZ 
AddCorsZZ $
(ZZ$ %
optionsZZ% ,
=>ZZ- /
{[[ 
options\\ 
.\\ 
	AddPolicy\\ !
(\\! "
$str\\" 1
,\\1 2
policy\\3 9
=>\\: <
{]] 
policy^^ 
.^^ 
WithOrigins^^ &
(^^& '
$str^^' >
)^^> ?
.__ 
AllowAnyHeader__ )
(__) *
)__* +
.`` 
AllowAnyMethod`` )
(``) *
)``* +
.aa 
AllowCredentialsaa +
(aa+ ,
)aa, -
;aa- .
}bb 
)bb 
;bb 
}cc 
)cc 
;cc 
builderee 
.ee 
Servicesee 
.ee 
AddDbContextee )
<ee) *
TW1DbContextee* 6
>ee6 7
(ee7 8
optionsee8 ?
=>ee@ B
{ff 
optionsgg 
.gg 
UseSqlServergg $
(gg$ %
builderhh 
.hh 
Configurationhh )
.hh) *
GetConnectionStringhh* =
(hh= >
$strhh> Q
)hhQ R
,hhR S
xii 
=>ii 
xii 
.ii 
MigrationsAssemblyii -
(ii- .
$strii. 3
)ii3 4
)jj 
.kk !
UseLazyLoadingProxieskk &
(kk& '
)kk' (
.ll 
LogToll 
(ll 
Consolell 
.ll 
	WriteLinell (
,ll( )
LogLevelll* 2
.ll2 3
Informationll3 >
)ll> ?
;ll? @
}mm 
)mm 
;mm 
varoo 
appoo 
=oo 
builderoo 
.oo 
Buildoo #
(oo# $
)oo$ %
;oo% &
appqq 
.qq 
UseMiddlewareqq 
<qq '
ExceptionHandlingMiddlewareqq 9
>qq9 :
(qq: ;
)qq; <
;qq< =
ifss 
(ss 
appss 
.ss 
Environmentss 
.ss  
IsDevelopmentss  -
(ss- .
)ss. /
)ss/ 0
{tt 
appuu 
.uu 

UseSwaggeruu 
(uu 
)uu  
;uu  !
appvv 
.vv 
UseSwaggerUIvv  
(vv  !
)vv! "
;vv" #
}ww 
appyy 
.yy 
UseHttpsRedirectionyy #
(yy# $
)yy$ %
;yy% &
appzz 
.zz 

UseRoutingzz 
(zz 
)zz 
;zz 
app{{ 
.{{ 
UseCors{{ 
({{ 
$str{{ '
){{' (
;{{( )
app|| 
.|| 
UseAuthentication|| !
(||! "
)||" #
;||# $
app}} 
.}} 
UseAuthorization}}  
(}}  !
)}}! "
;}}" #
app~~ 
.~~ 
UseStaticFiles~~ 
(~~ 
)~~  
;~~  !
app
ÄÄ 
.
ÄÄ 
MapControllers
ÄÄ 
(
ÄÄ 
)
ÄÄ  
;
ÄÄ  !
app
ÇÇ 
.
ÇÇ 
Run
ÇÇ 
(
ÇÇ 
)
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
}
ÑÑ 
}ÖÖ ﬂ	
YC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Models\ApiException.cs
	namespace 	
ReservationAPI
 
. 
Models 
{ 
public 

class 
ApiException 
: 
	Exception  )
{ 
public 
int 

StatusCode 
{ 
get  #
;# $
}% &
public 
string 
Message 
{ 
get  #
;# $
}% &
public 
string 
? 
Details 
{  
get! $
;$ %
}& '
public		 
ApiException		 
(		 
int		 

statusCode		  *
,		* +
string		, 2
message		3 :
,		: ;
string		< B
?		B C
details		D K
=		L M
null		N R
)		R S
{

 	

StatusCode 
= 

statusCode #
;# $
Message 
= 
message 
; 
Details 
= 
details 
; 
} 	
} 
} µ
lC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Middleware\ExceptionHandlingMiddleware.cs
	namespace 	
ReservationAPI
 
. 

Middleware #
{ 
public 

class '
ExceptionHandlingMiddleware ,
{ 
private		 
readonly		 
RequestDelegate		 (
_next		) .
;		. /
private

 
readonly

 
ILogger

  
<

  !'
ExceptionHandlingMiddleware

! <
>

< =
_logger

> E
;

E F
private 
readonly 
IHostEnvironment )
_env* .
;. /
public '
ExceptionHandlingMiddleware *
(* +
RequestDelegate+ :
next; ?
,? @
ILoggerA H
<H I'
ExceptionHandlingMiddlewareI d
>d e
loggerf l
,l m
IHostEnvironmentn ~
env	 Ç
)
Ç É
{ 	
_next 
= 
next 
; 
_logger 
= 
logger 
; 
_env 
= 
env 
; 
} 	
public 
async 
Task 
InvokeAsync %
(% &
HttpContext& 1
context2 9
)9 :
{ 	
try 
{ 
await 
_next 
( 
context #
)# $
;$ %
} 
catch 
( 
	Exception 
ex 
)  
{ 
_logger 
. 
LogError  
(  !
ex! #
,# $
ex% '
.' (
Message( /
)/ 0
;0 1
context 
. 
Response  
.  !
ContentType! ,
=- .
$str/ A
;A B
context 
. 
Response  
.  !

StatusCode! +
=, -
(. /
int/ 2
)2 3
HttpStatusCode3 A
.A B
InternalServerErrorB U
;U V
var   
response   
=   
_env   #
.  # $
IsDevelopment  $ 1
(  1 2
)  2 3
?!! 
new!! 
ApiException!! &
(!!& '
context!!' .
.!!. /
Response!!/ 7
.!!7 8

StatusCode!!8 B
,!!B C
ex!!D F
.!!F G
Message!!G N
,!!N O
ex!!P R
.!!R S

StackTrace!!S ]
?!!] ^
.!!^ _
ToString!!_ g
(!!g h
)!!h i
)!!i j
:"" 
new"" 
ApiException"" &
(""& '
context""' .
."". /
Response""/ 7
.""7 8

StatusCode""8 B
,""B C
$str""D [
)""[ \
;""\ ]
var$$ 
options$$ 
=$$ 
new$$ !!
JsonSerializerOptions$$" 7
{$$8 9 
PropertyNamingPolicy$$: N
=$$O P
JsonNamingPolicy$$Q a
.$$a b
	CamelCase$$b k
}$$l m
;$$m n
var%% 
json%% 
=%% 
JsonSerializer%% )
.%%) *
	Serialize%%* 3
(%%3 4
response%%4 <
,%%< =
options%%> E
)%%E F
;%%F G
await&& 
context&& 
.&& 
Response&& &
.&&& '

WriteAsync&&' 1
(&&1 2
json&&2 6
)&&6 7
;&&7 8
}'' 
}(( 	
})) 
}** ê
hC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Middleware\AuthorizationMiddleware.cs
	namespace 	
ReservationAPI
 
. 

Middleware #
{ 
public 

class #
AuthorizationMiddleware (
{ 
private 
readonly 
RequestDelegate (
_next) .
;. /
private		 
readonly		 
string		 
_requiredRole		  -
;		- .
public #
AuthorizationMiddleware &
(& '
RequestDelegate' 6
next7 ;
,; <
string= C
requiredRoleD P
)P Q
{ 	
_next 
= 
next 
; 
_requiredRole 
= 
requiredRole (
;( )
} 	
public 
async 
Task 
InvokeAsync %
(% &
HttpContext& 1
context2 9
)9 :
{ 	
var 
endpoint 
= 
context "
." #
GetEndpoint# .
(. /
)/ 0
;0 1
if 
( 
endpoint 
? 
. 
Metadata "
." #
GetMetadata# .
<. /
IAllowAnonymous/ >
>> ?
(? @
)@ A
!=B D
nullE I
)I J
{ 
await 
_next 
( 
context #
)# $
;$ %
return 
; 
} 
if 
( 
! 
context 
. 
User 
. 
Identity &
.& '
IsAuthenticated' 6
)6 7
{ 
context 
. 
Response  
.  !

StatusCode! +
=, -
StatusCodes. 9
.9 :!
Status401Unauthorized: O
;O P
await 
context 
. 
Response &
.& '

WriteAsync' 1
(1 2
$str2 P
)P Q
;Q R
return   
;   
}!! 
if$$ 
($$ 
!$$ 
context$$ 
.$$ 
User$$ 
.$$ 
IsInRole$$ &
($$& '
_requiredRole$$' 4
)$$4 5
)$$5 6
{%% 
context&& 
.&& 
Response&&  
.&&  !

StatusCode&&! +
=&&, -
StatusCodes&&. 9
.&&9 :
Status403Forbidden&&: L
;&&L M
await'' 
context'' 
.'' 
Response'' &
.''& '

WriteAsync''' 1
(''1 2
$"''2 4
$str''4 I
{''I J
_requiredRole''J W
}''W X
$str''X ]
"''] ^
)''^ _
;''_ `
return(( 
;(( 
})) 
await,, 
_next,, 
(,, 
context,, 
),,  
;,,  !
}-- 	
}.. 
}// ˝@
]C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Mappings\MappingProfile.cs
	namespace 	
ReservationAPI
 
. 
Mappings !
{ 
public		 

class		 
MappingProfile		 
:		  !
Profile		" )
{

 
public 
MappingProfile 
( 
) 
{ 	
	CreateMap 
< 
User 
, 
UserDto "
>" #
(# $
)$ %
.% &

ReverseMap& 0
(0 1
)1 2
;2 3
;4 5
	CreateMap 
< 
User 
, 
UserCreateUpdateDto /
>/ 0
(0 1
)1 2
.2 3

ReverseMap3 =
(= >
)> ?
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
RoleId( .
,. /
opt0 3
=>4 6
opt7 :
.: ;
MapFrom; B
(B C
srcC F
=>G I
srcJ M
.M N
RoleIdN T
==U W
$numX Y
?Z [
$num\ ]
:^ _
src` c
.c d
RoleIdd j
)j k
)k l
;l m
	CreateMap 
< 
Payment 
, 

PaymentDto )
>) *
(* +
)+ ,
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
UserName( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
MapFrom= D
(D E
srcE H
=>I K
srcL O
.O P
UserP T
.T U
EmailU Z
)Z [
)[ \
;\ ]
	CreateMap 
< "
PaymentCreateUpdateDto ,
,, -
Payment. 5
>5 6
(6 7
)7 8
;8 9
	CreateMap 
< 
	Promotion 
,  
PromotionDto  ,
>, -
(- .
). /
./ 0

ReverseMap0 :
(: ;
); <
;< =
	CreateMap 
< $
PromotionCreateUpdateDto .
,. /
	Promotion0 9
>9 :
(: ;
); <
;< =
	CreateMap 
< 
Reservation !
,! "
ReservationDto# 1
>1 2
(2 3
)3 4
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
UserName( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
MapFrom= D
(D E
srcE H
=>I K
srcL O
.O P
UserP T
.T U
EmailU Z
)Z [
)[ \
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
ResourceName( 4
,4 5
opt6 9
=>: <
opt= @
.@ A
MapFromA H
(H I
srcI L
=>M O
srcP S
.S T
ResourceT \
.\ ]
Name] a
)a b
)b c
;c d
	CreateMap 
< &
ReservationCreateUpdateDto 0
,0 1
Reservation2 =
>= >
(> ?
)? @
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
User( ,
,, -
opt. 1
=>2 4
opt5 8
.8 9
Ignore9 ?
(? @
)@ A
)A B
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Resource( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
Ignore= C
(C D
)D E
)E F
;F G
	CreateMap!! 
<!! 
Resource!! 
,!! 
ResourceDto!! *
>!!* +
(!!+ ,
)!!, -
.!!- .

ReverseMap!!. 8
(!!8 9
)!!9 :
;!!: ;
	CreateMap"" 
<"" #
ResourceCreateUpdateDto"" -
,""- .
Resource""/ 7
>""7 8
(""8 9
)""9 :
;"": ;
	CreateMap$$ 
<$$ 
Review$$ 
,$$ 
	ReviewDto$$ '
>$$' (
($$( )
)$$) *
.%% 
	ForMember%% 
(%% 
dest%% 
=>%%  "
dest%%# '
.%%' (
UserName%%( 0
,%%0 1
opt%%2 5
=>%%6 8
opt%%9 <
.%%< =
MapFrom%%= D
(%%D E
src%%E H
=>%%I K
src%%L O
.%%O P
User%%P T
.%%T U
Email%%U Z
)%%Z [
)%%[ \
.&& 
	ForMember&& 
(&& 
dest&& 
=>&&  "
dest&&# '
.&&' (
EscapeRoomName&&( 6
,&&6 7
opt&&8 ;
=>&&< >
opt&&? B
.&&B C
MapFrom&&C J
(&&J K
src&&K N
=>&&O Q
src&&R U
.&&U V

EscapeRoom&&V `
.&&` a
Name&&a e
)&&e f
)&&f g
;&&g h
	CreateMap'' 
<'' !
ReviewCreateUpdateDto'' +
,''+ ,
Review''- 3
>''3 4
(''4 5
)''5 6
;''6 7
	CreateMap** 
<** 
Role** 
,** 
RoleDto** "
>**" #
(**# $
)**$ %
.**% &

ReverseMap**& 0
(**0 1
)**1 2
;**2 3
	CreateMap++ 
<++ 
RoleCreateUpdateDto++ )
,++) *
Role+++ /
>++/ 0
(++0 1
)++1 2
;++2 3
	CreateMap-- 
<-- 
TimeSlot-- 
,-- 
TimeSlotDto-- *
>--* +
(--+ ,
)--, -
.--- .

ReverseMap--. 8
(--8 9
)--9 :
;--: ;
	CreateMap.. 
<.. #
TimeSlotCreateUpdateDto.. -
,..- .
TimeSlot../ 7
>..7 8
(..8 9
)..9 :
;..: ;
	CreateMap11 
<11 
LoginDto11 
,11 
AuthUser11  (
>11( )
(11) *
)11* +
.22 
	ForMember22 
(22 
dest22 
=>22  "
dest22# '
.22' (
PasswordHash22( 4
,224 5
opt226 9
=>22: <
opt22= @
.22@ A
Ignore22A G
(22G H
)22H I
)22I J
.33 
	ForMember33 
(33 
dest33 
=>33  "
dest33# '
.33' (
Role33( ,
,33, -
opt33. 1
=>332 4
opt335 8
.338 9
Ignore339 ?
(33? @
)33@ A
)33A B
;33B C
	CreateMap55 
<55 
RegisterDto55 !
,55! "
AuthUser55" *
>55* +
(55+ ,
)55, -
.66 
	ForMember66 
(66 
dest66 
=>66  "
dest66# '
.66' (
PasswordHash66( 4
,664 5
opt666 9
=>66: <
opt66= @
.66@ A
Ignore66A G
(66G H
)66H I
)66I J
.77 
	ForMember77 
(77 
dest77 
=>77  "
dest77# '
.77' (
Role77( ,
,77, -
opt77. 1
=>772 4
opt775 8
.778 9
Ignore779 ?
(77? @
)77@ A
)77A B
;77B C
	CreateMap:: 
<:: 
AuthRole:: 
,:: 
AuthRoleDto::  +
>::+ ,
(::, -
)::- .
.::. /

ReverseMap::/ 9
(::9 :
)::: ;
;::; <
};; 	
}<< 
}== ∑
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\UserCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class 
UserCreateUpdateDto $
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
?

 
Name

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
? 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
=( )
$num* +
;+ ,
} 
} Ê
hC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\TimeSlotCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class #
TimeSlotCreateUpdateDto (
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
DateTime

 
	StartTime

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
[ 	
Required	 
] 
public 
DateTime 
EndTime 
{  !
get" %
;% &
set' *
;* +
}, -
public 
bool 

IsReserved 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
false/ 4
;4 5
} 
} ª
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\RoleCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class 
RoleCreateUpdateDto $
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
RoleName 
Name 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ¬
fC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\ReviewCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class !
ReviewCreateUpdateDto &
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
int

 
EscapeRoomId

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
[ 	
Required	 
] 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
Rating 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
? 
Content 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

ReviewTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
DateTime3 ;
.; <
Now< ?
;? @
} 
} ˛
hC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\ResourceCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class #
ResourceCreateUpdateDto (
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
?

 
Name

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} —	
kC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\ReservationCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class &
ReservationCreateUpdateDto +
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
int

 
UserId

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
[ 	
Required	 
] 
public 
int 

ResourceId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
	StartTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
EndTime 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} ‚

iC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\PromotionCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class $
PromotionCreateUpdateDto )
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
?

 
Name

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
required 
string 
Code #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
float 
DiscountAmount #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DateTime 
PromotionEndTime (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
int 

UsageCount 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} €
gC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\PaymentCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class "
PaymentCreateUpdateDto '
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
PaymentType 
Type 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} ˚
WC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\UserDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
UserDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ‰
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\TimeSlotDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
TimeSlotDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
DateTime 
	StartTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
EndTime 
{  !
get" %
;% &
set' *
;* +
}, -
public 
bool 

IsReserved 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
false/ 4
;4 5
}		 
}

 Ì
WC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\RoleDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
RoleDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
RoleName 
Name 
{ 
get "
;" #
set$ '
;' (
}) *
}		 
}

 ™
YC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\ReviewDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
	ReviewDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
EscapeRoomId 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
int		 
UserId		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
public

 
int

 
Rating

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
public 
string 
? 
Content 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

ReviewTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
EscapeRoomName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} ∞
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\ResourceDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
ResourceDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
}		 ã
^C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\ReservationDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
ReservationDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 

ResourceId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
	StartTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
DateTime		 
EndTime		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
ResourceName "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} î

\C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\PromotionDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
PromotionDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
required 
string 
Code #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
float 
DiscountAmount #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public		 
DateTime		 
PromotionEndTime		 (
{		) *
get		+ .
;		. /
set		0 3
;		3 4
}		5 6
public

 
int

 

UsageCount

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
} 
} ∏
ZC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\PaymentDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 

PaymentDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public		 
PaymentType		 
Type		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
string

 
?

 
UserName

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
} 
} ß
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\RegisterDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
RegisterDto 
{ 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
} 
} 
_C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\RefreshTokenDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
RefreshTokenDto  
{ 
public 
string 
RefreshToken "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ˜
XC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\LoginDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
LoginDto 
{ 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ﬁ
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\AuthRoleDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
AuthRoleDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
} 
}		 …

_C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\AuthResponseDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
AuthResponseDto  
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 
int		 
RoleId		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
public

 
string

 
RefreshToken

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
=

1 2
string

3 9
.

9 :
Empty

: ?
;

? @
public 
virtual 
AuthRole 
Role  $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
} 
} √G
`C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\UserController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IUserRepository (
_userRepository) 8
;8 9
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserController 
( 
IUserRepository -
userRepository. <
,< =
IMapper> E
mapperF L
)L M
{ 	
_userRepository 
= 
userRepository ,
;, -
_mapper 
= 
mapper 
; 
} 	
[ 	
HttpGet	 
( 
Name 
= 
$str #
)# $
]$ %
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
public 
async 
Task 
< 
IActionResult '
>' (
GetAllUsersAsync) 9
(9 :
): ;
{ 	
var   
users   
=   
await   
_userRepository   -
.  - .
GetAllAsync  . 9
(  9 :
)  : ;
;  ; <
var!! 
userDtos!! 
=!! 
_mapper!! "
.!!" #
Map!!# &
<!!& '
IEnumerable!!' 2
<!!2 3
UserDto!!3 :
>!!: ;
>!!; <
(!!< =
users!!= B
)!!B C
;!!C D
return"" 
Ok"" 
("" 
userDtos"" 
)"" 
;""  
}%% 	
['' 	
HttpGet''	 
('' 
$str'' 
)'' 
]'' 
public(( 
async(( 
Task(( 
<(( 
IActionResult(( '
>((' (
GetUserByIdAsync(() 9
(((9 :
int((: =
id((> @
)((@ A
{)) 	
var** 
user** 
=** 
await** 
_userRepository** ,
.**, -
GetByIdAsync**- 9
(**9 :
id**: <
)**< =
;**= >
if++ 
(++ 
user++ 
==++ 
null++ 
)++ 
return,, 
NotFound,, 
(,,  
),,  !
;,,! "
return-- 
Ok-- 
(-- 
_mapper-- 
.-- 
Map-- !
<--! "
UserDto--" )
>--) *
(--* +
user--+ /
)--/ 0
)--0 1
;--1 2
}.. 	
[00 	
HttpGet00	 
(00 
$str00 
)00 
]00 
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' (
SearchUsersAsync11) 9
(119 :
[11: ;
	FromQuery11; D
]11D E
string11F L
?11L M
name11N R
,11R S
[11T U
	FromQuery11U ^
]11^ _
string11` f
?11f g
email11h m
)11m n
{22 	
var33 
users33 
=33 
await33 
_userRepository33 -
.33- .
	FindAsync33. 7
(337 8
u338 9
=>33: <
(44 
string44 
.44 
IsNullOrEmpty44 %
(44% &
name44& *
)44* +
||44, .
u44/ 0
.440 1
Name441 5
.445 6
Contains446 >
(44> ?
name44? C
,44C D
StringComparison44E U
.44U V
OrdinalIgnoreCase44V g
)44g h
)44h i
&&44j l
(55 
string55 
.55 
IsNullOrEmpty55 %
(55% &
email55& +
)55+ ,
||55- /
u550 1
.551 2
Email552 7
.557 8
Contains558 @
(55@ A
email55A F
,55F G
StringComparison55H X
.55X Y
OrdinalIgnoreCase55Y j
)55j k
)55k l
)66 
;66 
if88 
(88 
!88 
users88 
.88 
Any88 
(88 
)88 
)88 
return99 
NotFound99 
(99  
$str99  G
)99G H
;99H I
return;; 
Ok;; 
(;; 
_mapper;; 
.;; 
Map;; !
<;;! "
IEnumerable;;" -
<;;- .
UserDto;;. 5
>;;5 6
>;;6 7
(;;7 8
users;;8 =
);;= >
);;> ?
;;;? @
}<< 	
[>> 	
HttpPost>>	 
]>> 
public?? 
async?? 
Task?? 
<?? 
IActionResult?? '
>??' (
AddUserAsync??) 5
(??5 6
[??6 7
FromBody??7 ?
]??? @
UserCreateUpdateDto??A T
userDto??U \
)??\ ]
{@@ 	
varAA 
userAA 
=AA 
_mapperAA 
.AA 
MapAA "
<AA" #
UserAA# '
>AA' (
(AA( )
userDtoAA) 0
)AA0 1
;AA1 2
tryBB 
{CC 
awaitDD 
_userRepositoryDD %
.DD% &
AddAsyncDD& .
(DD. /
userDD/ 3
)DD3 4
;DD4 5
}EE 
catchFF 
(FF 
DbUpdateExceptionFF $
exFF% '
)FF' (
{GG 
returnHH 

StatusCodeHH !
(HH! "
$numHH" %
,HH% &
exHH' )
.HH) *
InnerExceptionHH* 8
?HH8 9
.HH9 :
MessageHH: A
??HHB D
exHHE G
.HHG H
MessageHHH O
)HHO P
;HHP Q
}II 
returnJJ 
CreatedAtActionJJ "
(JJ" #
nameofJJ# )
(JJ) *
GetUserByIdAsyncJJ* :
)JJ: ;
.JJ; <
ReplaceJJ< C
(JJC D
$strJJD K
,JJK L
$strJJM O
)JJO P
,JJP Q
newJJR U
{JJV W
idJJX Z
=JJ[ \
userJJ] a
.JJa b
IdJJb d
}JJe f
,JJf g
userDtoJJh o
)JJo p
;JJp q
}KK 	
[MM 	

HttpDeleteMM	 
]MM 
publicNN 
asyncNN 
TaskNN 
<NN 
IActionResultNN '
>NN' (
DeleteUserAsyncNN) 8
(NN8 9
[NN9 :
FromBodyNN: B
]NNB C
UserDtoNND K
userNNL P
)NNP Q
{OO 	
varPP 
entityPP 
=PP 
awaitPP 
_userRepositoryPP .
.PP. /
GetByIdAsyncPP/ ;
(PP; <
userPP< @
.PP@ A
IdPPA C
)PPC D
;PPD E
ifQQ 
(QQ 
entityQQ 
==QQ 
nullQQ 
)QQ 
{RR 
returnSS 
NotFoundSS 
(SS  
)SS  !
;SS! "
}TT 
elseUU 
{VV 
awaitWW 
_userRepositoryWW %
.WW% &
DeleteAsyncWW& 1
(WW1 2
entityWW2 8
)WW8 9
;WW9 :
returnXX 
	NoContentXX  
(XX  !
)XX! "
;XX" #
}YY 
}[[ 	
[]] 	
HttpPut]]	 
]]] 
public^^ 
async^^ 
Task^^ 
<^^ 
IActionResult^^ '
>^^' (
UpdateUserAsync^^) 8
(^^8 9
[^^9 :
FromBody^^: B
]^^B C
UserCreateUpdateDto^^D W
userDto^^X _
)^^_ `
{__ 	
var`` 
entity`` 
=`` 
await`` 
_userRepository`` .
.``. /
GetByIdAsync``/ ;
(``; <
userDto``< C
.``C D
Id``D F
)``F G
;``G H
ifaa 
(aa 
entityaa 
==aa 
nullaa 
)aa 
{bb 
returncc 
NotFoundcc 
(cc  
)cc  !
;cc! "
}dd 
elseee 
{ff 
_mappergg 
.gg 
Mapgg 
(gg 
userDtogg #
,gg# $
entitygg% +
)gg+ ,
;gg, -
awaitii 
_userRepositoryii %
.ii% &
UpdateAsyncii& 1
(ii1 2
entityii2 8
)ii8 9
;ii9 :
returnjj 
Okjj 
(jj 
)jj 
;jj 
}kk 
}ll 	
}oo 
}pp ∞5
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\TimeSlotController.cs
	namespace

 	
ReservationAPI


 
.

 
Controllers

 $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
TimeSlotController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
ITimeSlotRepository ,
timeSlotRepository- ?
;? @
private 
readonly 
IMapper  
mapper! '
;' (
public 
TimeSlotController !
(! "
ITimeSlotRepository" 5
timeSlotRepository6 H
,H I
IMapperJ Q
mapperR X
)X Y
{ 	
this 
. 
timeSlotRepository #
=$ %
timeSlotRepository& 8
;8 9
this 
. 
mapper 
= 
mapper  
;  !
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' ( 
GetAllTimeSlotsAsync) =
(= >
)> ?
{ 	
var 
timeSlotDto 
= 
await #
timeSlotRepository$ 6
.6 7
GetAllAsync7 B
(B C
)C D
;D E
var   
TimeSlotsDtos   
=   
mapper    &
.  & '
Map  ' *
<  * +
IEnumerable  + 6
<  6 7
TimeSlotDto  7 B
>  B C
>  C D
(  D E
timeSlotDto  E P
)  P Q
;  Q R
return!! 
Ok!! 
(!! 
TimeSlotsDtos!! #
)!!# $
;!!$ %
}"" 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' ( 
GetTimeSlotByIdAsync%%) =
(%%= >
int%%> A
id%%B D
)%%D E
{&& 	
var'' 
timeSlot'' 
='' 
await''  
timeSlotRepository''! 3
.''3 4
GetByIdAsync''4 @
(''@ A
id''A C
)''C D
;''D E
var(( 
timeSlotDto(( 
=(( 
mapper(( $
.(($ %
Map((% (
<((( )
TimeSlotDto(() 4
>((4 5
(((5 6
timeSlot((6 >
)((> ?
;((? @
if)) 
()) 
timeSlot)) 
==)) 
null))  
)))  !
return** 
NotFound** 
(**  
)**  !
;**! "
return++ 
Ok++ 
(++ 
timeSlotDto++ !
)++! "
;++" #
},, 	
[.. 	
HttpPost..	 
].. 
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
AddTimeSlotAsync//) 9
(//9 :
[//: ;
FromBody//; C
]//C D#
TimeSlotCreateUpdateDto//E \
timeSlotDto//] h
)//h i
{00 	
var11 
timeSlot11 
=11 
mapper11 !
.11! "
Map11" %
<11% &
TimeSlot11& .
>11. /
(11/ 0
timeSlotDto110 ;
)11; <
;11< =
await22 
timeSlotRepository22 $
.22$ %
AddAsync22% -
(22- .
timeSlot22. 6
)226 7
;227 8
return33 
CreatedAtAction33 "
(33" #
nameof33# )
(33) * 
GetTimeSlotByIdAsync33* >
)33> ?
.33? @
Replace33@ G
(33G H
$str33H O
,33O P
$str33Q S
)33S T
,33T U
new33V Y
{33Z [
id33\ ^
=33_ `
timeSlot33a i
.33i j
Id33j l
}33m n
,33n o
timeSlotDto33p {
)33{ |
;33| }
}44 	
[66 	

HttpDelete66	 
]66 
public77 
async77 
Task77 
<77 
IActionResult77 '
>77' ("
DeleteReservationAsync77) ?
(77? @
[77@ A
FromBody77A I
]77I J
TimeSlotDto77K V
timeSlotDto77W b
)77b c
{88 	
var99 
entity99 
=99 
await99 
timeSlotRepository99 1
.991 2
GetByIdAsync992 >
(99> ?
timeSlotDto99? J
.99J K
Id99K M
)99M N
;99N O
if:: 
(:: 
entity:: 
==:: 
null:: 
):: 
return;; 
NotFound;; 
(;;  
);;  !
;;;! "
else<< 
{== 
await>> 
timeSlotRepository>> (
.>>( )
DeleteAsync>>) 4
(>>4 5
entity>>5 ;
)>>; <
;>>< =
return?? 
	NoContent??  
(??  !
)??! "
;??" #
}@@ 
}AA 	
[CC 	
HttpPutCC	 
]CC 
publicDD 
asyncDD 
TaskDD 
<DD 
IActionResultDD '
>DD' ("
UpdateReservationAsyncDD) ?
(DD? @
[DD@ A
FromBodyDDA I
]DDI J#
TimeSlotCreateUpdateDtoDDK b
timeSlotDtoDDc n
)DDn o
{EE 	
varFF 
entityFF 
=FF 
awaitFF 
timeSlotRepositoryFF 1
.FF1 2
GetByIdAsyncFF2 >
(FF> ?
timeSlotDtoFF? J
.FFJ K
IdFFK M
)FFM N
;FFN O
ifGG 
(GG 
entityGG 
==GG 
nullGG 
)GG 
returnHH 
NotFoundHH 
(HH  
)HH  !
;HH! "
elseII 
{JJ 
mapperKK 
.KK 
MapKK 
(KK 
timeSlotDtoKK &
,KK& '
entityKK( .
)KK. /
;KK/ 0
awaitMM 
timeSlotRepositoryMM (
.MM( )
UpdateAsyncMM) 4
(MM4 5
entityMM5 ;
)MM; <
;MM< =
returnNN 
OkNN 
(NN 
)NN 
;NN 
}OO 
}PP 	
}SS 
}TT †P
bC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\ReviewController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ReviewController !
:" #
ControllerBase$ 2
{ 
private 
readonly 
IReviewRepository *
reviewRepository+ ;
;; <
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
TW1DbContext %
_context& .
;. /
public 
ReviewController 
(  
IReviewRepository  1
reviewRepository2 B
,B C
IMapperD K
mapperL R
,R S
TW1DbContextT `
contexta h
)h i
{ 	
this 
. 
reviewRepository !
=" #
reviewRepository$ 4
;4 5
_mapper 
= 
mapper 
; 
_context 
= 
context 
; 
} 	
[!! 	
	Authorize!!	 
(!! 
Roles!! 
=!! 
$str!! "
)!!" #
]!!# $
["" 	
HttpGet""	 
]"" 
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
GetAllReviewsAsync##) ;
(##; <
)##< =
{$$ 	
var%% 
reviews%% 
=%% 
await%% 
reviewRepository%%  0
.%%0 1
GetAllAsync%%1 <
(%%< =
)%%= >
;%%> ?
var&& 

reviewDtos&& 
=&& 
_mapper&& $
.&&$ %
Map&&% (
<&&( )
IEnumerable&&) 4
<&&4 5
	ReviewDto&&5 >
>&&> ?
>&&? @
(&&@ A
reviews&&A H
)&&H I
;&&I J
return'' 
Ok'' 
('' 

reviewDtos''  
)''  !
;''! "
}(( 	
[** 	
HttpGet**	 
(** 
$str** 
)** 
]** 
public++ 
async++ 
Task++ 
<++ 
IActionResult++ '
>++' (
GetReviewByIdAsync++) ;
(++; <
int++< ?
id++@ B
)++B C
{,, 	
var-- 
review-- 
=-- 
await-- 
reviewRepository-- /
.--/ 0
GetByIdAsync--0 <
(--< =
id--= ?
)--? @
;--@ A
if.. 
(.. 
review.. 
==.. 
null.. 
).. 
return// 
NotFound// 
(//  
)//  !
;//! "
return00 
Ok00 
(00 
review00 
)00 
;00 
}11 	
[33 	
HttpPost33	 
]33 
public44 
async44 
Task44 
<44 
IActionResult44 '
>44' (
AddReviewAsync44) 7
(447 8
[448 9
FromBody449 A
]44A B!
ReviewCreateUpdateDto44C X
dto44Y \
)44\ ]
{55 	
var66 
review66 
=66 
_mapper66  
.66  !
Map66! $
<66$ %
Review66% +
>66+ ,
(66, -
dto66- 0
)660 1
;661 2
review88 
.88 
User88 
=88 
await88 
_context88  (
.88( )
	AuthUsers88) 2
.882 3
	FindAsync883 <
(88< =
dto88= @
.88@ A
UserId88A G
)88G H
;88H I
review99 
.99 

EscapeRoom99 
=99 
await99  %
_context99& .
.99. /
	Resources99/ 8
.998 9
	FindAsync999 B
(99B C
dto99C F
.99F G
EscapeRoomId99G S
)99S T
;99T U
if;; 
(;; 
review;; 
.;; 
User;; 
==;; 
null;; #
||;;$ &
review;;' -
.;;- .

EscapeRoom;;. 8
==;;9 ;
null;;< @
);;@ A
{<< 
return== 

BadRequest== !
(==! "
$str==" C
)==C D
;==D E
}>> 
_context@@ 
.@@ 
Reviews@@ 
.@@ 
Add@@  
(@@  !
review@@! '
)@@' (
;@@( )
awaitAA 
_contextAA 
.AA 
SaveChangesAsyncAA +
(AA+ ,
)AA, -
;AA- .
varCC 
	reviewDtoCC 
=CC 
_mapperCC #
.CC# $
MapCC$ '
<CC' (
	ReviewDtoCC( 1
>CC1 2
(CC2 3
reviewCC3 9
)CC9 :
;CC: ;
returnDD 
CreatedAtActionDD "
(DD" #
nameofDD# )
(DD) *
GetReviewByIdAsyncDD* <
)DD< =
.DD= >
ReplaceDD> E
(DDE F
$strDDF M
,DDM N
$strDDO Q
)DDQ R
,DDR S
newDDT W
{DDX Y
idDDZ \
=DD] ^
reviewDD_ e
.DDe f
IdDDf h
}DDi j
,DDj k
	reviewDtoDDl u
)DDu v
;DDv w
}EE 	
[HH 	

HttpDeleteHH	 
]HH 
publicII 
asyncII 
TaskII 
<II 
IActionResultII '
>II' (
DeleteReviewAsyncII) :
(II: ;
[II; <
FromBodyII< D
]IID E
	ReviewDtoIIF O
reviewIIP V
)IIV W
{JJ 	
varKK 
entityKK 
=KK 
awaitKK 
reviewRepositoryKK /
.KK/ 0
GetByIdAsyncKK0 <
(KK< =
reviewKK= C
.KKC D
IdKKD F
)KKF G
;KKG H
ifLL 
(LL 
entityLL 
==LL 
nullLL 
)LL 
{MM 
returnNN 
NotFoundNN 
(NN  
)NN  !
;NN! "
}OO 
elsePP 
{QQ 
awaitRR 
reviewRepositoryRR &
.RR& '
DeleteAsyncRR' 2
(RR2 3
entityRR3 9
)RR9 :
;RR: ;
returnSS 
	NoContentSS  
(SS  !
)SS! "
;SS" #
}TT 
}VV 	
[XX 	
HttpPutXX	 
]XX 
publicYY 
asyncYY 
TaskYY 
<YY 
IActionResultYY '
>YY' (
UpdateReviewAsyncYY) :
(YY: ;
[YY; <
FromBodyYY< D
]YYD E!
ReviewCreateUpdateDtoYYF [
	reviewDtoYY\ e
)YYe f
{ZZ 	
var[[ 
entity[[ 
=[[ 
await[[ 
reviewRepository[[ /
.[[/ 0
GetByIdAsync[[0 <
([[< =
	reviewDto[[= F
.[[F G
Id[[G I
)[[I J
;[[J K
if\\ 
(\\ 
entity\\ 
==\\ 
null\\ 
)\\ 
{]] 
return^^ 
NotFound^^ 
(^^  
)^^  !
;^^! "
}__ 
else`` 
{aa 
_mapperbb 
.bb 
Mapbb 
(bb 
	reviewDtobb %
,bb% &
entitybb' -
)bb- .
;bb. /
awaitdd 
reviewRepositorydd &
.dd& '
UpdateAsyncdd' 2
(dd2 3
entitydd3 9
)dd9 :
;dd: ;
returnee 
Okee 
(ee 
)ee 
;ee 
}ff 
}gg 	
[ii 	
HttpGetii	 
(ii 
$strii  
)ii  !
]ii! "
publicjj 
asyncjj 
Taskjj 
<jj 
IActionResultjj '
>jj' (
GetUserReviewsAsyncjj) <
(jj< =
)jj= >
{kk 	
varll 
userIdClaimll 
=ll 
Userll "
.ll" #
	FindFirstll# ,
(ll, -

ClaimTypesll- 7
.ll7 8
NameIdentifierll8 F
)llF G
?llG H
.llH I
ValuellI N
;llN O
ifnn 
(nn 
stringnn 
.nn 
IsNullOrEmptynn $
(nn$ %
userIdClaimnn% 0
)nn0 1
||nn2 4
!nn5 6
intnn6 9
.nn9 :
TryParsenn: B
(nnB C
userIdClaimnnC N
,nnN O
outnnP S
varnnT W
userIdnnX ^
)nn^ _
)nn_ `
{oo 
returnpp 
Unauthorizedpp #
(pp# $
$strpp$ A
)ppA B
;ppB C
}qq 
varss 
userReviewsss 
=ss 
awaitss #
_contextss$ ,
.ss, -
Reviewsss- 4
.tt 
Wherett 
(tt 
rtt 
=>tt 
rtt 
.tt 
Usertt "
.tt" #
Idtt# %
==tt& (
userIdtt) /
)tt/ 0
.uu 
Includeuu 
(uu 
ruu 
=>uu 
ruu 
.uu  
Useruu  $
)uu$ %
.vv 
Includevv 
(vv 
rvv 
=>vv 
rvv 
.vv  

EscapeRoomvv  *
)vv* +
.ww 
ToListAsyncww 
(ww 
)ww 
;ww 
varyy 

reviewDtosyy 
=yy 
_mapperyy $
.yy$ %
Mapyy% (
<yy( )
Listyy) -
<yy- .
	ReviewDtoyy. 7
>yy7 8
>yy8 9
(yy9 :
userReviewsyy: E
)yyE F
;yyF G
return{{ 
Ok{{ 
({{ 

reviewDtos{{  
){{  !
;{{! "
}|| 	
}
ÄÄ 
}ÅÅ õ>
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\ResourceController.cs
	namespace

 	
ReservationAPI


 
.

 
Controllers

 $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ResourceController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
IResourceRepository ,
resourceRepository- ?
;? @
private 
readonly 
IMapper  
_mapper! (
;( )
public 
ResourceController !
(! "
IResourceRepository" 5
resourceRepository6 H
,H I
IMapperJ Q
mapperR X
)X Y
{ 	
this 
. 
resourceRepository #
=$ %
resourceRepository& 8
;8 9
_mapper 
= 
mapper 
; 
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' ( 
GetAllResourcesAsync) =
(= >
)> ?
{ 	
var 
	resources 
= 
await !
resourceRepository" 4
.4 5
GetAllAsync5 @
(@ A
)A B
;B C
var   
resourcesDtos   
=   
_mapper    '
.  ' (
Map  ( +
<  + ,
IEnumerable  , 7
<  7 8
ResourceDto  8 C
>  C D
>  D E
(  E F
	resources  F O
)  O P
;  P Q
return!! 
Ok!! 
(!! 
resourcesDtos!! #
)!!# $
;!!$ %
}"" 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' ( 
GetResourceByIdAsync%%) =
(%%= >
int%%> A
id%%B D
)%%D E
{&& 	
var'' 
resource'' 
='' 
await''  
resourceRepository''! 3
.''3 4
GetByIdAsync''4 @
(''@ A
id''A C
)''C D
;''D E
if(( 
((( 
resource(( 
==(( 
null((  
)((  !
return)) 
NotFound)) 
())  
)))  !
;))! "
return** 
Ok** 
(** 
resource** 
)** 
;**  
}++ 	
[-- 	
HttpGet--	 
(-- 
$str-- 
)-- 
]-- 
public.. 
async.. 
Task.. 
<.. 
IActionResult.. '
>..' ( 
SearchResourcesAsync..) =
(..= >
[..> ?
	FromQuery..? H
]..H I
string..J P
?..P Q
name..R V
)..V W
{// 	
var00 
	resources00 
=00 
await00 !
resourceRepository00" 4
.004 5
	FindAsync005 >
(00> ?
r00? @
=>00A C
string00D J
.00J K
IsNullOrEmpty00K X
(00X Y
name00Y ]
)00] ^
||00_ a
r00b c
.00c d
Name00d h
.00h i
Contains00i q
(00q r
name00r v
,00v w
StringComparison	00x à
.
00à â
OrdinalIgnoreCase
00â ö
)
00ö õ
)
00õ ú
;
00ú ù
if22 
(22 
!22 
	resources22 
.22 
Any22 
(22 
)22  
)22  !
return33 
NotFound33 
(33  
$str33  K
)33K L
;33L M
return55 
Ok55 
(55 
	resources55 
)55  
;55  !
}66 	
[88 	
HttpPost88	 
]88 
public99 
async99 
Task99 
<99 
IActionResult99 '
>99' (
AddResourceAsync99) 9
(999 :
[99: ;
FromBody99; C
]99C D#
ResourceCreateUpdateDto99E \
resourceDto99] h
)99h i
{:: 	
var;; 
resource;; 
=;; 
_mapper;; "
.;;" #
Map;;# &
<;;& '
Resource;;' /
>;;/ 0
(;;0 1
resourceDto;;1 <
);;< =
;;;= >
await<< 
resourceRepository<< $
.<<$ %
AddAsync<<% -
(<<- .
resource<<. 6
)<<6 7
;<<7 8
return== 
CreatedAtAction== "
(==" #
nameof==# )
(==) * 
GetResourceByIdAsync==* >
)==> ?
.==? @
Replace==@ G
(==G H
$str==H O
,==O P
$str==P R
)==R S
,==S T
new==U X
{==Y Z
id==[ ]
===^ _
resource==` h
.==h i
Id==i k
}==l m
,==m n
resourceDto==o z
)==z {
;=={ |
}>> 	
[@@ 	

HttpDelete@@	 
]@@ 
publicAA 
asyncAA 
TaskAA 
<AA 
IActionResultAA '
>AA' (
DeleteResourceAsyncAA) <
(AA< =
[AA= >
FromBodyAA> F
]AAF G
ResourceDtoAAH S
resourceAAT \
)AA\ ]
{BB 	
varCC 
entityCC 
=CC 
awaitCC 
resourceRepositoryCC 1
.CC1 2
GetByIdAsyncCC2 >
(CC> ?
resourceCC? G
.CCG H
IdCCH J
)CCJ K
;CCK L
ifDD 
(DD 
entityDD 
==DD 
nullDD 
)DD 
{EE 
returnFF 
NotFoundFF 
(FF  
)FF  !
;FF! "
}GG 
elseHH 
{II 
awaitJJ 
resourceRepositoryJJ (
.JJ( )
DeleteAsyncJJ) 4
(JJ4 5
entityJJ5 ;
)JJ; <
;JJ< =
returnKK 
	NoContentKK  
(KK  !
)KK! "
;KK" #
}LL 
}NN 	
[PP 	
HttpPutPP	 
]PP 
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
IActionResultQQ '
>QQ' (
UpdateResourceAsyncQQ) <
(QQ< =
[QQ= >
FromBodyQQ> F
]QQF G#
ResourceCreateUpdateDtoQQH _
resourceDtoQQ` k
)QQk l
{RR 	
varSS 
entitySS 
=SS 
awaitSS 
resourceRepositorySS 1
.SS1 2
GetByIdAsyncSS2 >
(SS> ?
resourceDtoSS? J
.SSJ K
IdSSK M
)SSM N
;SSN O
ifTT 
(TT 
entityTT 
==TT 
nullTT 
)TT 
{UU 
returnVV 
NotFoundVV 
(VV  
)VV  !
;VV! "
}WW 
elseXX 
{YY 
_mapperZZ 
.ZZ 
MapZZ 
(ZZ 
resourceDtoZZ '
,ZZ' (
entityZZ) /
)ZZ/ 0
;ZZ0 1
await\\ 
resourceRepository\\ (
.\\( )
UpdateAsync\\) 4
(\\4 5
entity\\5 ;
)\\; <
;\\< =
return]] 
Ok]] 
(]] 
)]] 
;]] 
}^^ 
}__ 	
}cc 
}dd ΩW
gC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\ReservationController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class !
ReservationController &
:' (
ControllerBase) 7
{ 
private 
readonly "
IReservationRepository /!
reservationRepository0 E
;E F
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
TW1DbContext %
_context& .
;. /
public !
ReservationController $
($ %"
IReservationRepository% ;!
reservationRepository< Q
,Q R
IMapperS Z
mapper[ a
,a b
TW1DbContextc o
contextp w
)w x
{ 	
this 
. !
reservationRepository &
=' (!
reservationRepository) >
;> ?
_mapper 
= 
mapper 
; 
_context 
= 
context 
; 
} 	
[   	
	Authorize  	 
(   
Roles   
=   
$str   "
)  " #
]  # $
[!! 	
HttpGet!!	 
]!! 
public"" 
async"" 
Task"" 
<"" 
IActionResult"" '
>""' (#
GetAllReservationsAsync"") @
(""@ A
)""A B
{## 	
var$$ 
reservations$$ 
=$$ 
await$$ $!
reservationRepository$$% :
.$$: ;
GetAllAsync$$; F
($$F G
)$$G H
;$$H I
var%% 
reservationsDtos%%  
=%%! "
_mapper%%# *
.%%* +
Map%%+ .
<%%. /
IEnumerable%%/ :
<%%: ;
ReservationDto%%; I
>%%I J
>%%J K
(%%K L
reservations%%L X
)%%X Y
;%%Y Z
return&& 
Ok&& 
(&& 
reservationsDtos&& &
)&&& '
;&&' (
}'' 	
[)) 	
HttpGet))	 
()) 
$str)) 
))) 
])) 
public** 
async** 
Task** 
<** 
IActionResult** '
>**' (#
GetReservationByIdAsync**) @
(**@ A
int**A D
id**E G
)**G H
{++ 	
var,, 
reservation,, 
=,, 
await,, #!
reservationRepository,,$ 9
.,,9 :
GetByIdAsync,,: F
(,,F G
id,,G I
),,I J
;,,J K
var-- 
reservationDto-- 
=--  
_mapper--! (
.--( )
Map--) ,
<--, -
ReservationDto--- ;
>--; <
(--< =
reservation--= H
)--H I
;--I J
if.. 
(.. 
reservation.. 
==.. 
null.. #
)..# $
return// 
NotFound// 
(//  
)//  !
;//! "
return00 
Ok00 
(00 
reservationDto00 $
)00$ %
;00% &
}11 	
[33 	
HttpPost33	 
]33 
public44 
async44 
Task44 
<44 
IActionResult44 '
>44' (
AddReservationAsync44) <
(44< =
[44= >
FromBody44> F
]44F G&
ReservationCreateUpdateDto44H b
dto44c f
)44f g
{55 	
var66 
reservation66 
=66 
_mapper66 %
.66% &
Map66& )
<66) *
Reservation66* 5
>665 6
(666 7
dto667 :
)66: ;
;66; <
reservation88 
.88 
User88 
=88 
await88 $
_context88% -
.88- .
	AuthUsers88. 7
.887 8
	FindAsync888 A
(88A B
dto88B E
.88E F
UserId88F L
)88L M
;88M N
reservation99 
.99 
Resource99  
=99! "
await99# (
_context99) 1
.991 2
	Resources992 ;
.99; <
	FindAsync99< E
(99E F
dto99F I
.99I J

ResourceId99J T
)99T U
;99U V
if;; 
(;; 
reservation;; 
.;; 
User;;  
==;;! #
null;;$ (
||;;) +
reservation;;, 7
.;;7 8
Resource;;8 @
==;;A C
null;;D H
);;H I
{<< 
return== 

BadRequest== !
(==! "
$str==" A
)==A B
;==B C
}>> 
_context@@ 
.@@ 
Reservations@@ !
.@@! "
Add@@" %
(@@% &
reservation@@& 1
)@@1 2
;@@2 3
tryAA 
{BB 
awaitCC 
_contextCC 
.CC 
SaveChangesAsyncCC /
(CC/ 0
)CC0 1
;CC1 2
}DD 
catchEE 
(EE 
DbUpdateExceptionEE $
exEE% '
)EE' (
{FF 
returnGG 

StatusCodeGG !
(GG! "
$numGG" %
,GG% &
exGG' )
.GG) *
InnerExceptionGG* 8
?GG8 9
.GG9 :
MessageGG: A
??GGB D
exGGE G
.GGG H
MessageGGH O
)GGO P
;GGP Q
}HH 
varJJ 
resultJJ 
=JJ 
_mapperJJ  
.JJ  !
MapJJ! $
<JJ$ %
ReservationDtoJJ% 3
>JJ3 4
(JJ4 5
reservationJJ5 @
)JJ@ A
;JJA B
returnKK 
CreatedAtActionKK "
(KK" #
nameofKK# )
(KK) *#
GetReservationByIdAsyncKK* A
)KKA B
.KKB C
ReplaceKKC J
(KKJ K
$strKKK R
,KKR S
$strKKT V
)KKV W
,KKW X
newKKY \
{KK] ^
idKK_ a
=KKb c
reservationKKd o
.KKo p
IdKKp r
}KKs t
,KKt u
resultKKv |
)KK| }
;KK} ~
}LL 	
[NN 	

HttpDeleteNN	 
]NN 
publicOO 
asyncOO 
TaskOO 
<OO 
IActionResultOO '
>OO' ("
DeleteReservationAsyncOO) ?
(OO? @
[OO@ A
FromBodyOOA I
]OOI J
ReservationDtoOOK Y
reservationDtoOOZ h
)OOh i
{PP 	
varQQ 
entityQQ 
=QQ 
awaitQQ !
reservationRepositoryQQ 4
.QQ4 5
GetByIdAsyncQQ5 A
(QQA B
reservationDtoQQB P
.QQP Q
IdQQQ S
)QQS T
;QQT U
ifRR 
(RR 
entityRR 
==RR 
nullRR 
)RR 
returnSS 
NotFoundSS 
(SS  
)SS  !
;SS! "
elseTT 
{UU 
awaitVV !
reservationRepositoryVV +
.VV+ ,
DeleteAsyncVV, 7
(VV7 8
entityVV8 >
)VV> ?
;VV? @
returnWW 
	NoContentWW  
(WW  !
)WW! "
;WW" #
}XX 
}YY 	
[[[ 	
HttpPut[[	 
][[ 
public\\ 
async\\ 
Task\\ 
<\\ 
IActionResult\\ '
>\\' ("
UpdateReservationAsync\\) ?
(\\? @
[\\@ A
FromBody\\A I
]\\I J&
ReservationCreateUpdateDto\\J d
reservationDto\\e s
)\\s t
{]] 	
var^^ 
entity^^ 
=^^ 
await^^ !
reservationRepository^^ 4
.^^4 5
GetByIdAsync^^5 A
(^^A B
reservationDto^^B P
.^^P Q
Id^^Q S
)^^S T
;^^T U
if__ 
(__ 
entity__ 
==__ 
null__ 
)__ 
return`` 
NotFound`` 
(``  
)``  !
;``! "
elseaa 
{bb 
_mappercc 
.cc 
Mapcc 
(cc 
reservationDtocc *
,cc* +
entitycc, 2
)cc2 3
;cc3 4
awaitee !
reservationRepositoryee +
.ee+ ,
UpdateAsyncee, 7
(ee7 8
entityee8 >
)ee> ?
;ee? @
returnff 
Okff 
(ff 
reservationDtoff (
)ff( )
;ff) *
}gg 
}hh 	
[jj 	
HttpGetjj	 
(jj 
$strjj &
)jj& '
]jj' (
publickk 
asynckk 
Taskkk 
<kk 
IActionResultkk '
>kk' ($
GetUserReservationsAsynckk) A
(kkA B
)kkB C
{ll 	
varmm 
userIdClaimmm 
=mm 
Usermm "
.mm" #
	FindFirstmm# ,
(mm, -

ClaimTypesmm- 7
.mm7 8
NameIdentifiermm8 F
)mmF G
?mmG H
.mmH I
ValuemmI N
;mmN O
ifoo 
(oo 
stringoo 
.oo 
IsNullOrEmptyoo $
(oo$ %
userIdClaimoo% 0
)oo0 1
||oo2 4
!oo5 6
intoo6 9
.oo9 :
TryParseoo: B
(ooB C
userIdClaimooC N
,ooN O
outooP S
varooT W
userIdooX ^
)oo^ _
)oo_ `
{pp 
returnqq 
Unauthorizedqq #
(qq# $
$strqq$ A
)qqA B
;qqB C
}rr 
vartt 
userReservationstt  
=tt! "
awaittt# (
_contexttt) 1
.tt1 2
Reservationstt2 >
.uu 
Whereuu 
(uu 
ruu 
=>uu 
ruu 
.uu 
UserIduu $
==uu% '
userIduu( .
)uu. /
.vv 
Includevv 
(vv 
rvv 
=>vv 
rvv 
.vv  
Uservv  $
)vv$ %
.ww 
Includeww 
(ww 
rww 
=>ww 
rww 
.ww  
Resourceww  (
)ww( )
.xx 
ToListAsyncxx 
(xx 
)xx 
;xx 
varzz 
reservationDtoszz 
=zz  !
_mapperzz" )
.zz) *
Mapzz* -
<zz- .
Listzz. 2
<zz2 3
ReservationDtozz3 A
>zzA B
>zzB C
(zzC D
userReservationszzD T
)zzT U
;zzU V
return|| 
Ok|| 
(|| 
reservationDtos|| %
)||% &
;||& '
}}} 	
}
ÄÄ 
}ÅÅ Û5
eC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\PromotionController.cs
	namespace

 	
ReservationAPI


 
.

 
Controllers

 $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
PromotionController $
:% &
ControllerBase' 5
{ 
private 
readonly  
IPromotionRepository -
promotionRepository. A
;A B
private 
readonly 
IMapper  
mapper! '
;' (
public 
PromotionController "
(" # 
IPromotionRepository# 7
promotionRepository8 K
,K L
IMapperM T
mapperU [
)[ \
{ 	
this 
. 
promotionRepository $
=% &
promotionRepository' :
;: ;
this 
. 
mapper 
= 
mapper  
;  !
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (!
GetAllPromotionsAsync) >
(> ?
)? @
{ 	
var 
reservations 
= 
await $
promotionRepository% 8
.8 9
GetAllAsync9 D
(D E
)E F
;F G
var   
reservationsDtos    
=  ! "
mapper  # )
.  ) *
Map  * -
<  - .
IEnumerable  . 9
<  9 :
PromotionDto  : F
>  F G
>  G H
(  H I
reservations  I U
)  U V
;  V W
return!! 
Ok!! 
(!! 
reservationsDtos!! &
)!!& '
;!!' (
}"" 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' (#
GetReservationByIdAsync%%) @
(%%@ A
int%%A D
id%%E G
)%%G H
{&& 	
var'' 
reservation'' 
='' 
await'' #
promotionRepository''$ 7
.''7 8
GetByIdAsync''8 D
(''D E
id''E G
)''G H
;''H I
var(( 
reservationDto(( 
=((  
mapper((! '
.((' (
Map((( +
<((+ ,
PromotionDto((, 8
>((8 9
(((9 :
reservation((: E
)((E F
;((F G
if)) 
()) 
reservation)) 
==)) 
null)) #
)))# $
return** 
NotFound** 
(**  
)**  !
;**! "
return++ 
Ok++ 
(++ 
reservationDto++ $
)++$ %
;++% &
},, 	
[.. 	
HttpPost..	 
].. 
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
AddReservationAsync//) <
(//< =
[//= >
FromBody//> F
]//F G$
PromotionCreateUpdateDto//H `
promotionDto//a m
)//m n
{00 	
var11 
	promotion11 
=11 
mapper11 "
.11" #
Map11# &
<11& '
	Promotion11' 0
>110 1
(111 2
promotionDto112 >
)11> ?
;11? @
await22 
promotionRepository22 %
.22% &
AddAsync22& .
(22. /
	promotion22/ 8
)228 9
;229 :
return33 
CreatedAtAction33 "
(33" #
nameof33# )
(33) *#
GetReservationByIdAsync33* A
)33A B
.33B C
Replace33C J
(33J K
$str33K R
,33R S
$str33S U
)33U V
,33V W
new33X [
{33\ ]
id33] _
=33` a
	promotion33c l
.33l m
Id33m o
}33o p
,33p q
promotionDto33r ~
)33~ 
;	33 Ä
}44 	
[66 	

HttpDelete66	 
]66 
public77 
async77 
Task77 
<77 
IActionResult77 '
>77' ("
DeleteReservationAsync77) ?
(77? @
[77@ A
FromBody77A I
]77I J
PromotionDto77K W
promotionDto77X d
)77d e
{88 	
var99 
entity99 
=99 
await99 
promotionRepository99 2
.992 3
GetByIdAsync993 ?
(99? @
promotionDto99@ L
.99L M
Id99M O
)99O P
;99P Q
if:: 
(:: 
entity:: 
==:: 
null:: 
):: 
return;; 
NotFound;; 
(;;  
);;  !
;;;! "
else<< 
{== 
await>> 
promotionRepository>> )
.>>) *
DeleteAsync>>* 5
(>>5 6
entity>>6 <
)>>< =
;>>= >
return?? 
	NoContent??  
(??  !
)??! "
;??" #
}@@ 
}AA 	
[CC 	
HttpPutCC	 
]CC 
publicDD 
asyncDD 
TaskDD 
<DD 
IActionResultDD '
>DD' ("
UpdateReservationAsyncDD) ?
(DD? @
[DD@ A
FromBodyDDA I
]DDI J$
PromotionCreateUpdateDtoDDK c
promotionDtoDDd p
)DDp q
{EE 	
varFF 
entityFF 
=FF 
awaitFF 
promotionRepositoryFF 2
.FF2 3
GetByIdAsyncFF3 ?
(FF? @
promotionDtoFF@ L
.FFL M
IdFFM O
)FFO P
;FFP Q
ifGG 
(GG 
entityGG 
==GG 
nullGG 
)GG 
returnHH 
NotFoundHH 
(HH  
)HH  !
;HH! "
elseII 
{JJ 
mapperKK 
.KK 
MapKK 
(KK 
promotionDtoKK '
,KK' (
entityKK) /
)KK/ 0
;KK0 1
awaitMM 
promotionRepositoryMM )
.MM) *
UpdateAsyncMM* 5
(MM5 6
entityMM6 <
)MM< =
;MM= >
returnNN 
OkNN 
(NN 
)NN 
;NN 
}OO 
}PP 	
}SS 
}TT ñ<
cC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\PaymentController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
PaymentController "
:# $
ControllerBase% 3
{ 
private 
readonly 
TW1DbContext %
context& -
;- .
private 
readonly 
IPaymentRepository +
paymentRepository, =
;= >
private 
readonly 
IMapper  
_mapper! (
;( )
public 
PaymentController  
(  !
IPaymentRepository! 3
paymentRepository4 E
,E F
IMapperG N
mapperO U
,U V
TW1DbContextW c
contextd k
)k l
{ 	
this 
. 
paymentRepository "
=# $
paymentRepository% 6
;6 7
_mapper 
= 
mapper 
; 
this 
. 
context 
= 
context "
;" #
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[   	
HttpGet  	 
]   
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
GetAllPaymentsAsync!!) <
(!!< =
)!!= >
{"" 	
var## 
payments## 
=## 
await##  
paymentRepository##! 2
.##2 3
GetAllAsync##3 >
(##> ?
)##? @
;##@ A
var$$ 
paymentDtos$$ 
=$$ 
_mapper$$ %
.$$% &
Map$$& )
<$$) *
IEnumerable$$* 5
<$$5 6

PaymentDto$$6 @
>$$@ A
>$$A B
($$B C
payments$$C K
)$$K L
;$$L M
return%% 
Ok%% 
(%% 
paymentDtos%% !
)%%! "
;%%" #
}&& 	
[(( 	
HttpGet((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
GetPaymentByIdAsync))) <
())< =
int))= @
id))A C
)))C D
{** 	
var++ 
payment++ 
=++ 
await++ 
paymentRepository++  1
.++1 2
GetByIdAsync++2 >
(++> ?
id++? A
)++A B
;++B C
if,, 
(,, 
payment,, 
==,, 
null,, 
),,  
return-- 
NotFound-- 
(--  
)--  !
;--! "
return.. 
Ok.. 
(.. 
payment.. 
).. 
;.. 
}// 	
[11 	
HttpPost11	 
]11 
public22 
async22 
Task22 
<22 
IActionResult22 '
>22' (
AddPaymentAsync22) 8
(228 9
[229 :
FromBody22: B
]22B C"
PaymentCreateUpdateDto22D Z

paymentDto22[ e
)22e f
{33 	
var44 
payment44 
=44 
_mapper44 !
.44! "
Map44" %
<44% &
Payment44& -
>44- .
(44. /

paymentDto44/ 9
)449 :
;44: ;
try55 
{66 
await77 
paymentRepository77 '
.77' (
AddAsync77( 0
(770 1
payment771 8
)778 9
;779 :
}88 
catch99 
(99 
DbUpdateException99 $
ex99% '
)99' (
{:: 
return;; 

StatusCode;; !
(;;! "
$num;;" %
,;;% &
ex;;' )
.;;) *
InnerException;;* 8
?;;8 9
.;;9 :
Message;;: A
??;;B D
ex;;E G
.;;G H
Message;;H O
);;O P
;;;P Q
}<< 
await== 
context== 
.== 
SaveChangesAsync== *
(==* +
)==+ ,
;==, -
return>> 
CreatedAtAction>> "
(>>" #
nameof>># )
(>>) *
GetPaymentByIdAsync>>* =
)>>= >
.>>> ?
Replace>>? F
(>>F G
$str>>G N
,>>N O
$str>>O Q
)>>Q R
,>>R S
new>>T W
{>>X Y
id>>Z \
=>>] ^
payment>>_ f
.>>f g
Id>>g i
}>>j k
,>>k l

paymentDto>>m w
)>>w x
;>>x y
}?? 	
[AA 	

HttpDeleteAA	 
]AA 
publicBB 
asyncBB 
TaskBB 
<BB 
IActionResultBB '
>BB' (
DeletePaymentAsyncBB) ;
(BB; <
[BB< =
FromBodyBB= E
]BBE F

PaymentDtoBBG Q
paymentBBR Y
)BBY Z
{CC 	
varDD 
entityDD 
=DD 
awaitDD 
paymentRepositoryDD 0
.DD0 1
GetByIdAsyncDD1 =
(DD= >
paymentDD> E
.DDE F
IdDDF H
)DDH I
;DDI J
ifEE 
(EE 
entityEE 
==EE 
nullEE 
)EE 
{FF 
returnGG 
NotFoundGG 
(GG  
)GG  !
;GG! "
}HH 
elseII 
{JJ 
awaitKK 
paymentRepositoryKK '
.KK' (
DeleteAsyncKK( 3
(KK3 4
entityKK4 :
)KK: ;
;KK; <
awaitLL 
contextLL 
.LL 
SaveChangesAsyncLL .
(LL. /
)LL/ 0
;LL0 1
returnMM 
	NoContentMM  
(MM  !
)MM! "
;MM" #
}NN 
}OO 	
[QQ 	
HttpPutQQ	 
]QQ 
publicRR 
asyncRR 
TaskRR 
<RR 
IActionResultRR '
>RR' (
UpdatePaymentAsyncRR) ;
(RR; <
[RR< =
FromBodyRR= E
]RRE F"
PaymentCreateUpdateDtoRRG ]

paymentDtoRR^ h
)RRh i
{SS 	
varTT 
entityTT 
=TT 
awaitTT 
paymentRepositoryTT 0
.TT0 1
GetByIdAsyncTT1 =
(TT= >

paymentDtoTT> H
.TTH I
IdTTI K
)TTK L
;TTL M
ifUU 
(UU 
entityUU 
==UU 
nullUU 
)UU 
{VV 
returnWW 
NotFoundWW 
(WW  
)WW  !
;WW! "
}XX 
elseYY 
{ZZ 
_mapper[[ 
.[[ 
Map[[ 
([[ 

paymentDto[[ &
,[[& '
entity[[' -
)[[- .
;[[. /
await]] 
paymentRepository]] '
.]]' (
UpdateAsync]]( 3
(]]3 4
entity]]4 :
)]]: ;
;]]; <
await^^ 
context^^ 
.^^ 
SaveChangesAsync^^ .
(^^. /
)^^/ 0
;^^0 1
return__ 
Ok__ 
(__ 
)__ 
;__ 
}`` 
}aa 	
}dd 
}ee áC
`C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\AuthController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly 
TW1DbContext %
context& -
;- .
private 
readonly 
AuthService $

jwtService% /
;/ 0
private 
readonly 
IMapper  
_mapper! (
;( )
public 
AuthController 
( 
TW1DbContext *
context+ 2
,2 3
AuthService4 ?

jwtService@ J
,J K
IMapperL S
mapperT Z
)Z [
{ 	
this 
. 
context 
= 
context "
;" #
this 
. 

jwtService 
= 

jwtService (
;( )
_mapper 
= 
mapper 
; 
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
RegisterAsync) 6
(6 7
RegisterDto7 B
dtoC F
)F G
{   	
var!! 
Register!! 
=!! 
_mapper!! "
.!!" #
Map!!# &
<!!& '
AuthUser!!' /
>!!/ 0
(!!0 1
dto!!1 4
)!!4 5
;!!5 6
Register"" 
."" 
PasswordHash"" !
=""" #
BCrypt""$ *
.""* +
Net""+ .
."". /
BCrypt""/ 5
.""5 6
HashPassword""6 B
(""B C
dto""C F
.""F G
Password""G O
)""O P
;""P Q
Register## 
.## 
Role## 
=## 
await## !
context##" )
.##) *
	AuthRoles##* 3
.##3 4
	FindAsync##4 =
(##= >
dto##> A
.##A B
RoleId##B H
)##H I
;##I J
await%% 
context%% 
.%% 
	AuthUsers%% #
.%%# $
AddAsync%%$ ,
(%%, -
Register%%- 5
)%%5 6
;%%6 7
try&& 
{'' 
await(( 
context(( 
.(( 
SaveChangesAsync(( .
(((. /
)((/ 0
;((0 1
})) 
catch** 
(** 
DbUpdateException** $
ex**% '
)**' (
{++ 
return,, 

StatusCode,, !
(,,! "
$num,," %
,,,% &
ex,,' )
.,,) *
InnerException,,* 8
?,,8 9
.,,9 :
Message,,: A
??,,B D
ex,,E G
.,,G H
Message,,H O
),,O P
;,,P Q
}-- 
return.. 
Ok.. 
(.. 
Register.. 
).. 
;..  
}// 	
[11 	
HttpPost11	 
(11 
$str11 
)11 
]11 
public22 
async22 
Task22 
<22 
IActionResult22 '
>22' (

LoginAsync22) 3
(223 4
LoginDto224 <
dto22= @
)22@ A
{33 	
var44 
user44 
=44 
await44 
context44 $
.44$ %
	AuthUsers44% .
.55 
Include55 
(55 
u55 
=>55 
u55 
.55  
Role55  $
)55$ %
.66 
FirstOrDefaultAsync66 $
(66$ %
u66% &
=>66' )
u66* +
.66+ ,
Email66, 1
==662 4
dto665 8
.668 9
Email669 >
)66> ?
;66? @
if77 
(77 
user77 
==77 
null77 
||77 
!77  !
BCrypt77! '
.77' (
Net77( +
.77+ ,
BCrypt77, 2
.772 3
Verify773 9
(779 :
dto77: =
.77= >
Password77> F
,77F G
user77H L
.77L M
PasswordHash77M Y
)77Y Z
)77Z [
return88 
Unauthorized88 #
(88# $
$str88$ 9
)889 :
;88: ;
var:: 
token:: 
=:: 

jwtService:: "
.::" #
GenerateJwtToken::# 3
(::3 4
user::4 8
)::8 9
;::9 :
var;; 
refreshToken;; 
=;; 

jwtService;; )
.;;) * 
GenerateRefreshToken;;* >
(;;> ?
user;;? C
);;C D
;;;D E
return== 
Ok== 
(== 
new== 
{== 
token>> 
,>> 
refreshToken?? 
,?? 
}AA 
)AA 
;AA 
}BB 	
[DD 	
HttpPostDD	 
(DD 
$strDD 
)DD 
]DD 
publicEE 
asyncEE 
TaskEE 
<EE 
IActionResultEE '
>EE' (
RefreshAsyncEE) 5
(EE5 6
RefreshTokenDtoEE6 E
dtoEEF I
)EEI J
{FF 	
varGG 
userGG 
=GG 
awaitGG 
contextGG $
.GG$ %
	AuthUsersGG% .
.HH 
IncludeHH 
(HH 
uHH 
=>HH 
uHH 
.HH  
RoleHH  $
)HH$ %
.II 
FirstOrDefaultAsyncII $
(II$ %
uII% &
=>II' )
uII* +
.II+ ,
RefreshTokenII, 8
==II9 ;
dtoII< ?
.II? @
RefreshTokenII@ L
)IIL M
;IIM N
ifKK 
(KK 
userKK 
==KK 
nullKK 
)KK 
returnLL 
UnauthorizedLL #
(LL# $
$strLL$ ;
)LL; <
;LL< =
varNN 
tokenNN 
=NN 

jwtServiceNN "
.NN" #
GenerateJwtTokenNN# 3
(NN3 4
userNN4 8
)NN8 9
;NN9 :
varOO 
refreshTokenOO 
=OO 

jwtServiceOO )
.OO) * 
GenerateRefreshTokenOO* >
(OO> ?
userOO? C
)OOC D
;OOD E
returnQQ 
OkQQ 
(QQ 
newQQ 
{QQ 
tokenQQ !
,QQ! "
refreshTokenQQ# /
}QQ0 1
)QQ1 2
;QQ2 3
}RR 	
[SS 	
	AuthorizeSS	 
(SS 
RolesSS 
=SS 
$strSS "
)SS" #
]SS# $
[TT 	
HttpPostTT	 
(TT 
$strTT 
)TT 
]TT 
publicUU 
asyncUU 
TaskUU 
<UU 
IActionResultUU '
>UU' (
AddRoleUU) 0
(UU0 1
AuthRoleDtoUU1 <
dtoUU= @
)UU@ A
{VV 	
varWW 
roleWW 
=WW 
_mapperWW 
.WW 
MapWW "
<WW" #
AuthRoleWW# +
>WW+ ,
(WW, -
dtoWW- 0
)WW0 1
;WW1 2
awaitXX 
contextXX 
.XX 
	AuthRolesXX #
.XX# $
AddAsyncXX$ ,
(XX, -
roleXX- 1
)XX1 2
;XX2 3
tryYY 
{ZZ 
await[[ 
context[[ 
.[[ 
SaveChangesAsync[[ .
([[. /
)[[/ 0
;[[0 1
}\\ 
catch]] 
(]] 
DbUpdateException]] $
ex]]% '
)]]' (
{^^ 
return__ 

StatusCode__ !
(__! "
$num__" %
,__% &
ex__' )
.__) *
InnerException__* 8
?__8 9
.__9 :
Message__: A
??__B D
ex__E G
.__G H
Message__H O
)__O P
;__P Q
}`` 
returnaa 
Okaa 
(aa 
roleaa 
)aa 
;aa 
}bb 	
}cc 
}dd 