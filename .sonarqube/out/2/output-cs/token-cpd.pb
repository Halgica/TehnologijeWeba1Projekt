î	
ZC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Settings\JwtSettings.cs
	namespace 	
ReservationAPI
 
. 
Settings !
{ 
public 

class 
JwtSettings 
{ 
public 
string 
Secret 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Issuer 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Audience 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
int 
ExpiryMinutes  
{! "
get# &
;& '
set( +
;+ ,
}- .
}		 
}

 ∆a
MC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Program.cs
publicää 
class
ää 
Program
ää 
{ãã 
public
åå 

static
åå 
void
åå 
Main
åå 
(
åå 
string
åå "
[
åå" #
]
åå# $
args
åå% )
)
åå) *
{
çç 
var
éé 
builder
éé 
=
éé 
WebApplication
éé $
.
éé$ %
CreateBuilder
éé% 2
(
éé2 3
args
éé3 7
)
éé7 8
;
éé8 9
builder
êê 
.
êê 
Host
êê 
.
êê 

UseSerilog
êê 
(
êê  
(
êê  !
context
êê! (
,
êê( )
services
êê* 2
,
êê2 3
configuration
êê4 A
)
êêA B
=>
êêC E
configuration
ëë 
.
ëë 
ReadFrom
ëë "
.
ëë" #
Configuration
ëë# 0
(
ëë0 1
context
ëë1 8
.
ëë8 9
Configuration
ëë9 F
)
ëëF G
)
ëëG H
;
ëëH I
builder
ìì 
.
ìì 
Services
ìì 
.
ìì 
	Configure
ìì "
<
ìì" #
JwtSettings
ìì# .
>
ìì. /
(
ìì/ 0
builder
ìì0 7
.
ìì7 8
Configuration
ìì8 E
.
ììE F

GetSection
ììF P
(
ììP Q
$str
ììQ ^
)
ìì^ _
)
ìì_ `
;
ìì` a
builder
ïï 
.
ïï 
Services
ïï 
.
ïï 
AddAuthentication
ïï *
(
ïï* +
options
ïï+ 2
=>
ïï3 5
{
ññ 	
options
óó 
.
óó '
DefaultAuthenticateScheme
óó -
=
óó. /
JwtBearerDefaults
óó0 A
.
óóA B"
AuthenticationScheme
óóB V
;
óóV W
options
òò 
.
òò $
DefaultChallengeScheme
òò *
=
òò+ ,
JwtBearerDefaults
òò- >
.
òò> ?"
AuthenticationScheme
òò? S
;
òòS T
}
ôô 	
)
ôô	 

.
öö 	
AddJwtBearer
öö	 
(
öö 
options
öö 
=>
öö  
{
õõ 	
var
úú 
jwtSettings
úú 
=
úú 
builder
úú %
.
úú% &
Configuration
úú& 3
.
úú3 4

GetSection
úú4 >
(
úú> ?
$str
úú? L
)
úúL M
.
úúM N
Get
úúN Q
<
úúQ R
JwtSettings
úúR ]
>
úú] ^
(
úú^ _
)
úú_ `
;
úú` a
options
ùù 
.
ùù '
TokenValidationParameters
ùù -
=
ùù. /
new
ùù0 3'
TokenValidationParameters
ùù4 M
{
ûû 
ValidateIssuer
üü 
=
üü  
true
üü! %
,
üü% &
ValidateAudience
††  
=
††! "
true
††# '
,
††' (
ValidateLifetime
°°  
=
°°! "
true
°°# '
,
°°' (&
ValidateIssuerSigningKey
¢¢ (
=
¢¢) *
true
¢¢+ /
,
¢¢/ 0
ValidIssuer
££ 
=
££ 
jwtSettings
££ )
.
££) *
Issuer
££* 0
,
££0 1
ValidAudience
§§ 
=
§§ 
jwtSettings
§§  +
.
§§+ ,
Audience
§§, 4
,
§§4 5
IssuerSigningKey
••  
=
••! "
new
••# &"
SymmetricSecurityKey
••' ;
(
••; <
Encoding
••< D
.
••D E
UTF8
••E I
.
••I J
GetBytes
••J R
(
••R S
jwtSettings
••S ^
.
••^ _
Secret
••_ e
)
••e f
)
••f g
}
¶¶ 
;
¶¶ 
}
ßß 	
)
ßß	 

;
ßß
 
builder
©© 
.
©© 
Services
©© 
.
©© 
AddSwaggerGen
©© &
(
©©& '
c
©©' (
=>
©©) +
{
™™ 	
c
´´ 
.
´´ #
AddSecurityDefinition
´´ #
(
´´# $
$str
´´$ ,
,
´´, -
new
´´. 1#
OpenApiSecurityScheme
´´2 G
{
¨¨ 
Description
≠≠ 
=
≠≠ 
$str
≠≠ Q
,
≠≠Q R
Name
ÆÆ 
=
ÆÆ 
$str
ÆÆ &
,
ÆÆ& '
In
ØØ 
=
ØØ 
ParameterLocation
ØØ &
.
ØØ& '
Header
ØØ' -
,
ØØ- .
Type
∞∞ 
=
∞∞  
SecuritySchemeType
∞∞ )
.
∞∞) *
Http
∞∞* .
,
∞∞. /
Scheme
±± 
=
±± 
$str
±± !
,
±±! "
BearerFormat
≤≤ 
=
≤≤ 
$str
≤≤ $
}
≥≥ 
)
≥≥ 
;
≥≥ 
c
µµ 
.
µµ $
AddSecurityRequirement
µµ $
(
µµ$ %
new
µµ% ((
OpenApiSecurityRequirement
µµ) C
{
∂∂ 
{
∑∑ 	
new
∏∏ #
OpenApiSecurityScheme
∏∏ %
{
ππ 
	Reference
∫∫ 
=
∫∫ 
new
∫∫ 
OpenApiReference
∫∫  0
{
ªª 
Type
ºº 
=
ºº 
ReferenceType
ºº (
.
ºº( )
SecurityScheme
ºº) 7
,
ºº7 8
Id
ΩΩ 
=
ΩΩ 
$str
ΩΩ !
}
ææ 
}
øø 
,
øø 
new
¿¿ 
string
¿¿ 
[
¿¿ 
]
¿¿ 
{
¿¿ 
}
¿¿ 
}
¡¡ 	
}
¬¬ 
)
¬¬ 
;
¬¬ 
}
√√ 	
)
√√	 

;
√√
 
builder
≈≈ 
.
≈≈ 
Services
≈≈ 
.
≈≈ 
AddAutoMapper
≈≈ &
(
≈≈& '
typeof
≈≈' -
(
≈≈- .
Program
≈≈. 5
)
≈≈5 6
)
≈≈6 7
;
≈≈7 8
builder
∆∆ 
.
∆∆ 
Services
∆∆ 
.
∆∆ 
AddControllers
∆∆ '
(
∆∆' (
)
∆∆( )
;
∆∆) *
builder
«« 
.
«« 
Services
«« 
.
«« %
AddEndpointsApiExplorer
«« 0
(
««0 1
)
««1 2
;
««2 3
builder
»» 
.
»» 
Services
»» 
.
»» 
AddSwaggerGen
»» &
(
»»& '
)
»»' (
;
»»( )
builder
   
.
   
Services
   
.
   
	AddScoped
   "
<
  " #
IUserRepository
  # 2
,
  2 3
UserRepository
  4 B
>
  B C
(
  C D
)
  D E
;
  E F
builder
ÀÀ 
.
ÀÀ 
Services
ÀÀ 
.
ÀÀ 
	AddScoped
ÀÀ "
<
ÀÀ" #!
IResourceRepository
ÀÀ# 6
,
ÀÀ6 7 
ResourceRepository
ÀÀ8 J
>
ÀÀJ K
(
ÀÀK L
)
ÀÀL M
;
ÀÀM N
builder
ÃÃ 
.
ÃÃ 
Services
ÃÃ 
.
ÃÃ 
	AddScoped
ÃÃ "
<
ÃÃ" #$
IReservationRepository
ÃÃ# 9
,
ÃÃ9 :#
ReservationRepository
ÃÃ; P
>
ÃÃP Q
(
ÃÃQ R
)
ÃÃR S
;
ÃÃS T
builder
ÕÕ 
.
ÕÕ 
Services
ÕÕ 
.
ÕÕ 
	AddScoped
ÕÕ "
<
ÕÕ" # 
IPaymentRepository
ÕÕ# 5
,
ÕÕ5 6
PaymentRepository
ÕÕ7 H
>
ÕÕH I
(
ÕÕI J
)
ÕÕJ K
;
ÕÕK L
builder
ŒŒ 
.
ŒŒ 
Services
ŒŒ 
.
ŒŒ 
	AddScoped
ŒŒ "
<
ŒŒ" #"
IPromotionRepository
ŒŒ# 7
,
ŒŒ7 8!
PromotionRepository
ŒŒ9 L
>
ŒŒL M
(
ŒŒM N
)
ŒŒN O
;
ŒŒO P
builder
œœ 
.
œœ 
Services
œœ 
.
œœ 
	AddScoped
œœ "
<
œœ" #
IReviewRepository
œœ# 4
,
œœ4 5
ReviewRepository
œœ6 F
>
œœF G
(
œœG H
)
œœH I
;
œœI J
builder
–– 
.
–– 
Services
–– 
.
–– 
	AddScoped
–– "
<
––" #
IRoleRepository
––# 2
,
––2 3
RoleRepository
––4 B
>
––B C
(
––C D
)
––D E
;
––E F
builder
—— 
.
—— 
Services
—— 
.
—— 
	AddScoped
—— "
<
——" #!
ITimeSlotRepository
——# 6
,
——6 7 
TimeSlotRepository
——8 J
>
——J K
(
——K L
)
——L M
;
——M N
builder
““ 
.
““ 
Services
““ 
.
““ 
	AddScoped
““ "
<
““" #
AuthService
““# .
>
““. /
(
““/ 0
)
““0 1
;
““1 2
builder
‘‘ 
.
‘‘ 
Services
‘‘ 
.
‘‘ 
AddCors
‘‘  
(
‘‘  !
options
‘‘! (
=>
‘‘) +
{
’’ 	
options
÷÷ 
.
÷÷ 
	AddPolicy
÷÷ 
(
÷÷ 
$str
÷÷ -
,
÷÷- .
policy
÷÷/ 5
=>
÷÷6 8
{
◊◊ 
policy
ÿÿ 
.
ÿÿ 
WithOrigins
ÿÿ "
(
ÿÿ" #
$str
ÿÿ# :
)
ÿÿ: ;
.
ŸŸ 
AllowAnyHeader
ŸŸ %
(
ŸŸ% &
)
ŸŸ& '
.
⁄⁄ 
AllowAnyMethod
⁄⁄ %
(
⁄⁄% &
)
⁄⁄& '
.
€€ 
AllowCredentials
€€ '
(
€€' (
)
€€( )
;
€€) *
}
‹‹ 
)
‹‹ 
;
‹‹ 
}
›› 	
)
››	 

;
››
 
builder
ﬂﬂ 
.
ﬂﬂ 
Services
ﬂﬂ 
.
ﬂﬂ 
AddDbContext
ﬂﬂ %
<
ﬂﬂ% &
TW1DbContext
ﬂﬂ& 2
>
ﬂﬂ2 3
(
ﬂﬂ3 4
options
ﬂﬂ4 ;
=>
ﬂﬂ< >
{
‡‡ 	
options
·· 
.
·· 
UseSqlServer
··  
(
··  !
builder
‚‚ 
.
‚‚ 
Configuration
‚‚ %
.
‚‚% &!
GetConnectionString
‚‚& 9
(
‚‚9 :
$str
‚‚: M
)
‚‚M N
,
‚‚N O
x
„„ 
=>
„„ 
x
„„ 
.
„„  
MigrationsAssembly
„„ )
(
„„) *
$str
„„* /
)
„„/ 0
)
‰‰ 
.
ÂÂ #
UseLazyLoadingProxies
ÂÂ "
(
ÂÂ" #
)
ÂÂ# $
.
ÊÊ 
LogTo
ÊÊ 
(
ÊÊ 
Console
ÊÊ 
.
ÊÊ 
	WriteLine
ÊÊ $
,
ÊÊ$ %
LogLevel
ÊÊ& .
.
ÊÊ. /
Information
ÊÊ/ :
)
ÊÊ: ;
;
ÊÊ; <
}
ÁÁ 	
)
ÁÁ	 

;
ÁÁ
 
var
ÈÈ 
app
ÈÈ 
=
ÈÈ 
builder
ÈÈ 
.
ÈÈ 
Build
ÈÈ 
(
ÈÈ  
)
ÈÈ  !
;
ÈÈ! "
app
ÎÎ 
.
ÎÎ 
UseMiddleware
ÎÎ 
<
ÎÎ )
ExceptionHandlingMiddleware
ÎÎ 5
>
ÎÎ5 6
(
ÎÎ6 7
)
ÎÎ7 8
;
ÎÎ8 9
if
ÓÓ 

(
ÓÓ 
app
ÓÓ 
.
ÓÓ 
Environment
ÓÓ 
.
ÓÓ 
IsDevelopment
ÓÓ )
(
ÓÓ) *
)
ÓÓ* +
)
ÓÓ+ ,
{
ÔÔ 	
app
 
.
 

UseSwagger
 
(
 
)
 
;
 
app
ÒÒ 
.
ÒÒ 
UseSwaggerUI
ÒÒ 
(
ÒÒ 
)
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
app
ÙÙ 
.
ÙÙ !
UseHttpsRedirection
ÙÙ 
(
ÙÙ  
)
ÙÙ  !
;
ÙÙ! "
app
ıı 
.
ıı 

UseRouting
ıı 
(
ıı 
)
ıı 
;
ıı 
app
ˆˆ 
.
ˆˆ 
UseCors
ˆˆ 
(
ˆˆ 
$str
ˆˆ #
)
ˆˆ# $
;
ˆˆ$ %
app
˜˜ 
.
˜˜ 
UseAuthentication
˜˜ 
(
˜˜ 
)
˜˜ 
;
˜˜  
app
¯¯ 
.
¯¯ 
UseAuthorization
¯¯ 
(
¯¯ 
)
¯¯ 
;
¯¯ 
app
˘˘ 
.
˘˘ 
UseStaticFiles
˘˘ 
(
˘˘ 
)
˘˘ 
;
˘˘ 
app
˚˚ 
.
˚˚ 
MapControllers
˚˚ 
(
˚˚ 
)
˚˚ 
;
˚˚ 
app
˝˝ 
.
˝˝ 
Run
˝˝ 
(
˝˝ 
)
˝˝ 
;
˝˝ 
}
˛˛ 
}ˇˇ Ω#
ZC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Services\AuthService.cs
	namespace

 	
ReservationAPI


 
.

 
Services

 !
{ 
public 

class 
AuthService 
{ 
private 
readonly 
IConfiguration '
_config( /
;/ 0
private 
readonly 
TW1DbContext %

_dbContext& 0
;0 1
public 
AuthService 
( 
IConfiguration )
config* 0
,0 1
TW1DbContext2 >
context? F
)F G
{ 	
_config 
= 
config 
; 

_dbContext 
= 
context  
;  !
} 	
public 
string 
GenerateJwtToken &
(& '
AuthUser' /
user0 4
)4 5
{ 	
var 
jwtSettings 
= 
_config %
.% &

GetSection& 0
(0 1
$str1 >
)> ?
.? @
Get@ C
<C D
JwtSettingsD O
>O P
(P Q
)Q R
;R S
var 
claims 
= 
new 
[ 
] 
{ 
new 
Claim 
( #
JwtRegisteredClaimNames 1
.1 2
Sub2 5
,5 6
user7 ;
.; <
Id< >
.> ?
ToString? G
(G H
)H I
)I J
,J K
new 
Claim 
( #
JwtRegisteredClaimNames 1
.1 2
Email2 7
,7 8
user9 =
.= >
Email> C
)C D
,D E
new 
Claim 
( 

ClaimTypes $
.$ %
Role% )
,) *
user+ /
./ 0
Role0 4
.4 5
Name5 9
)9 :
}   
;   
var!! 
key!! 
=!! 
new!!  
SymmetricSecurityKey!! .
(!!. /
Encoding!!/ 7
.!!7 8
UTF8!!8 <
.!!< =
GetBytes!!= E
(!!E F
jwtSettings!!F Q
.!!Q R
Secret!!R X
)!!X Y
)!!Y Z
;!!Z [
var"" 
creds"" 
="" 
new"" 
SigningCredentials"" .
("". /
key""/ 2
,""2 3
SecurityAlgorithms""4 F
.""F G

HmacSha256""G Q
)""Q R
;""R S
var$$ 
token$$ 
=$$ 
new$$ 
JwtSecurityToken$$ ,
($$, -
issuer%% 
:%% 
jwtSettings%% #
.%%# $
Issuer%%$ *
,%%* +
audience&& 
:&& 
jwtSettings&& %
.&&% &
Audience&&& .
,&&. /
claims'' 
:'' 
claims'' 
,'' 
expires(( 
:(( 
DateTime(( !
.((! "
UtcNow((" (
.((( )

AddMinutes(() 3
(((3 4
jwtSettings((4 ?
.((? @
ExpiryMinutes((@ M
)((M N
,((N O
signingCredentials)) "
:))" #
creds))$ )
)** 
;** 
return++ 
new++ #
JwtSecurityTokenHandler++ .
(++. /
)++/ 0
.++0 1

WriteToken++1 ;
(++; <
token++< A
)++A B
;++B C
},, 	
public-- 
string--  
GenerateRefreshToken-- *
(--* +
AuthUser--+ 3
user--4 8
)--8 9
{.. 	
var// 
refreshToken// 
=// 
Guid// #
.//# $
NewGuid//$ +
(//+ ,
)//, -
.//- .
ToString//. 6
(//6 7
)//7 8
;//8 9
user00 
.00 
RefreshToken00 
=00 
refreshToken00  ,
;00, -

_dbContext22 
.22 
Update22 
(22 
user22 "
)22" #
;22# $

_dbContext33 
.33 
SaveChanges33 "
(33" #
)33# $
;33$ %
return55 
refreshToken55 
;55  
}66 	
}77 
}88 π	
YC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Models\ApiException.cs
	namespace 	
ReservationAPI
 
. 
Models 
{ 
public 

class 
ApiException 
{ 
public 
int 

StatusCode 
{ 
get  #
;# $
}% &
public 
string 
Message 
{ 
get  #
;# $
}% &
public 
string 
? 
Details 
{  
get! $
;$ %
}& '
public		 
ApiException		 
(		 
int		 

statusCode		  *
,		* +
string		, 2
message		3 :
,		: ;
string		< B
?		B C
details		D K
=		L M
null		N R
)		R S
{

 	

StatusCode 
= 

statusCode #
;# $
Message 
= 
message 
; 
Details 
= 
details 
; 
} 	
} 
} ◊
lC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Middleware\ExceptionHandlingMiddleware.cs
	namespace 	
ReservationAPI
 
. 

Middleware #
{ 
public 

class '
ExceptionHandlingMiddleware ,
{ 
private		 
readonly		 
RequestDelegate		 (
_next		) .
;		. /
private

 
readonly

 
ILogger

  
<

  !'
ExceptionHandlingMiddleware

! <
>

< =
_logger

> E
;

E F
private 
readonly 
IHostEnvironment )
_env* .
;. /
public '
ExceptionHandlingMiddleware *
(* +
RequestDelegate+ :
next; ?
,? @
ILoggerA H
<H I'
ExceptionHandlingMiddlewareI d
>d e
loggerf l
,l m
IHostEnvironmentn ~
env	 Ç
)
Ç É
{ 	
_next 
= 
next 
; 
_logger 
= 
logger 
; 
_env 
= 
env 
; 
} 	
public 
async 
Task 
InvokeAsync %
(% &
HttpContext& 1
context2 9
)9 :
{ 	
try 
{ 
await 
_next 
( 
context #
)# $
;$ %
} 
catch 
( 
	Exception 
ex 
)  
{ 
_logger 
. 
LogError  
(  !
ex! #
,# $
ex% '
.' (
Message( /
)/ 0
;0 1
context 
. 
Response  
.  !
ContentType! ,
=- .
$str/ A
;A B
context 
. 
Response  
.  !

StatusCode! +
=, -
(. /
int/ 2
)2 3
HttpStatusCode3 A
.A B
InternalServerErrorB U
;U V
var   
response   
=   
_env   #
.  # $
IsDevelopment  $ 1
(  1 2
)  2 3
?!! 
new!! 
ApiException!! &
(!!& '
context!!' .
.!!. /
Response!!/ 7
.!!7 8

StatusCode!!8 B
,!!B C
ex!!D F
.!!F G
Message!!G N
,!!N O
ex!!P R
.!!R S

StackTrace!!S ]
?!!] ^
.!!^ _
ToString!!_ g
(!!g h
)!!h i
)!!i j
:"" 
new"" 
ApiException"" &
(""& '
context""' .
."". /
Response""/ 7
.""7 8

StatusCode""8 B
,""B C
$str""D [
)""[ \
;""\ ]
var$$ 
options$$ 
=$$ 
new$$ !!
JsonSerializerOptions$$" 7
{$$8 9 
PropertyNamingPolicy$$: N
=$$O P
JsonNamingPolicy$$Q a
.$$a b
	CamelCase$$b k
}$$l m
;$$m n
var%% 
json%% 
=%% 
JsonSerializer%% )
.%%) *
	Serialize%%* 3
(%%3 4
response%%4 <
,%%< =
options%%> E
)%%E F
;%%F G
await&& 
context&& 
.&& 
Response&& &
.&&& '

WriteAsync&&' 1
(&&1 2
json&&2 6
)&&6 7
;&&7 8
throw'' 
;'' 
}(( 
})) 	
}** 
}++ ê
hC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Middleware\AuthorizationMiddleware.cs
	namespace 	
ReservationAPI
 
. 

Middleware #
{ 
public 

class #
AuthorizationMiddleware (
{ 
private 
readonly 
RequestDelegate (
_next) .
;. /
private		 
readonly		 
string		 
_requiredRole		  -
;		- .
public #
AuthorizationMiddleware &
(& '
RequestDelegate' 6
next7 ;
,; <
string= C
requiredRoleD P
)P Q
{ 	
_next 
= 
next 
; 
_requiredRole 
= 
requiredRole (
;( )
} 	
public 
async 
Task 
InvokeAsync %
(% &
HttpContext& 1
context2 9
)9 :
{ 	
var 
endpoint 
= 
context "
." #
GetEndpoint# .
(. /
)/ 0
;0 1
if 
( 
endpoint 
? 
. 
Metadata "
." #
GetMetadata# .
<. /
IAllowAnonymous/ >
>> ?
(? @
)@ A
!=B D
nullE I
)I J
{ 
await 
_next 
( 
context #
)# $
;$ %
return 
; 
} 
if 
( 
! 
context 
. 
User 
. 
Identity &
.& '
IsAuthenticated' 6
)6 7
{ 
context 
. 
Response  
.  !

StatusCode! +
=, -
StatusCodes. 9
.9 :!
Status401Unauthorized: O
;O P
await 
context 
. 
Response &
.& '

WriteAsync' 1
(1 2
$str2 P
)P Q
;Q R
return   
;   
}!! 
if$$ 
($$ 
!$$ 
context$$ 
.$$ 
User$$ 
.$$ 
IsInRole$$ &
($$& '
_requiredRole$$' 4
)$$4 5
)$$5 6
{%% 
context&& 
.&& 
Response&&  
.&&  !

StatusCode&&! +
=&&, -
StatusCodes&&. 9
.&&9 :
Status403Forbidden&&: L
;&&L M
await'' 
context'' 
.'' 
Response'' &
.''& '

WriteAsync''' 1
(''1 2
$"''2 4
$str''4 I
{''I J
_requiredRole''J W
}''W X
$str''X ]
"''] ^
)''^ _
;''_ `
return(( 
;(( 
})) 
await,, 
_next,, 
(,, 
context,, 
),,  
;,,  !
}-- 	
}.. 
}// ˝@
]C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Mappings\MappingProfile.cs
	namespace 	
ReservationAPI
 
. 
Mappings !
{ 
public		 

class		 
MappingProfile		 
:		  !
Profile		" )
{

 
public 
MappingProfile 
( 
) 
{ 	
	CreateMap 
< 
User 
, 
UserDto "
>" #
(# $
)$ %
.% &

ReverseMap& 0
(0 1
)1 2
;2 3
;4 5
	CreateMap 
< 
User 
, 
UserCreateUpdateDto /
>/ 0
(0 1
)1 2
.2 3

ReverseMap3 =
(= >
)> ?
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
RoleId( .
,. /
opt0 3
=>4 6
opt7 :
.: ;
MapFrom; B
(B C
srcC F
=>G I
srcJ M
.M N
RoleIdN T
==U W
$numX Y
?Z [
$num\ ]
:^ _
src` c
.c d
RoleIdd j
)j k
)k l
;l m
	CreateMap 
< 
Payment 
, 

PaymentDto )
>) *
(* +
)+ ,
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
UserName( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
MapFrom= D
(D E
srcE H
=>I K
srcL O
.O P
UserP T
.T U
EmailU Z
)Z [
)[ \
;\ ]
	CreateMap 
< "
PaymentCreateUpdateDto ,
,, -
Payment. 5
>5 6
(6 7
)7 8
;8 9
	CreateMap 
< 
	Promotion 
,  
PromotionDto  ,
>, -
(- .
). /
./ 0

ReverseMap0 :
(: ;
); <
;< =
	CreateMap 
< $
PromotionCreateUpdateDto .
,. /
	Promotion0 9
>9 :
(: ;
); <
;< =
	CreateMap 
< 
Reservation !
,! "
ReservationDto# 1
>1 2
(2 3
)3 4
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
UserName( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
MapFrom= D
(D E
srcE H
=>I K
srcL O
.O P
UserP T
.T U
EmailU Z
)Z [
)[ \
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
ResourceName( 4
,4 5
opt6 9
=>: <
opt= @
.@ A
MapFromA H
(H I
srcI L
=>M O
srcP S
.S T
ResourceT \
.\ ]
Name] a
)a b
)b c
;c d
	CreateMap 
< &
ReservationCreateUpdateDto 0
,0 1
Reservation2 =
>= >
(> ?
)? @
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
User( ,
,, -
opt. 1
=>2 4
opt5 8
.8 9
Ignore9 ?
(? @
)@ A
)A B
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Resource( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
Ignore= C
(C D
)D E
)E F
;F G
	CreateMap!! 
<!! 
Resource!! 
,!! 
ResourceDto!! *
>!!* +
(!!+ ,
)!!, -
.!!- .

ReverseMap!!. 8
(!!8 9
)!!9 :
;!!: ;
	CreateMap"" 
<"" #
ResourceCreateUpdateDto"" -
,""- .
Resource""/ 7
>""7 8
(""8 9
)""9 :
;"": ;
	CreateMap$$ 
<$$ 
Review$$ 
,$$ 
	ReviewDto$$ '
>$$' (
($$( )
)$$) *
.%% 
	ForMember%% 
(%% 
dest%% 
=>%%  "
dest%%# '
.%%' (
UserName%%( 0
,%%0 1
opt%%2 5
=>%%6 8
opt%%9 <
.%%< =
MapFrom%%= D
(%%D E
src%%E H
=>%%I K
src%%L O
.%%O P
User%%P T
.%%T U
Email%%U Z
)%%Z [
)%%[ \
.&& 
	ForMember&& 
(&& 
dest&& 
=>&&  "
dest&&# '
.&&' (
EscapeRoomName&&( 6
,&&6 7
opt&&8 ;
=>&&< >
opt&&? B
.&&B C
MapFrom&&C J
(&&J K
src&&K N
=>&&O Q
src&&R U
.&&U V

EscapeRoom&&V `
.&&` a
Name&&a e
)&&e f
)&&f g
;&&g h
	CreateMap'' 
<'' !
ReviewCreateUpdateDto'' +
,''+ ,
Review''- 3
>''3 4
(''4 5
)''5 6
;''6 7
	CreateMap** 
<** 
Role** 
,** 
RoleDto** "
>**" #
(**# $
)**$ %
.**% &

ReverseMap**& 0
(**0 1
)**1 2
;**2 3
	CreateMap++ 
<++ 
RoleCreateUpdateDto++ )
,++) *
Role+++ /
>++/ 0
(++0 1
)++1 2
;++2 3
	CreateMap-- 
<-- 
TimeSlot-- 
,-- 
TimeSlotDto-- *
>--* +
(--+ ,
)--, -
.--- .

ReverseMap--. 8
(--8 9
)--9 :
;--: ;
	CreateMap.. 
<.. #
TimeSlotCreateUpdateDto.. -
,..- .
TimeSlot../ 7
>..7 8
(..8 9
)..9 :
;..: ;
	CreateMap11 
<11 
LoginDto11 
,11 
AuthUser11  (
>11( )
(11) *
)11* +
.22 
	ForMember22 
(22 
dest22 
=>22  "
dest22# '
.22' (
PasswordHash22( 4
,224 5
opt226 9
=>22: <
opt22= @
.22@ A
Ignore22A G
(22G H
)22H I
)22I J
.33 
	ForMember33 
(33 
dest33 
=>33  "
dest33# '
.33' (
Role33( ,
,33, -
opt33. 1
=>332 4
opt335 8
.338 9
Ignore339 ?
(33? @
)33@ A
)33A B
;33B C
	CreateMap55 
<55 
RegisterDto55 !
,55! "
AuthUser55" *
>55* +
(55+ ,
)55, -
.66 
	ForMember66 
(66 
dest66 
=>66  "
dest66# '
.66' (
PasswordHash66( 4
,664 5
opt666 9
=>66: <
opt66= @
.66@ A
Ignore66A G
(66G H
)66H I
)66I J
.77 
	ForMember77 
(77 
dest77 
=>77  "
dest77# '
.77' (
Role77( ,
,77, -
opt77. 1
=>772 4
opt775 8
.778 9
Ignore779 ?
(77? @
)77@ A
)77A B
;77B C
	CreateMap:: 
<:: 
AuthRole:: 
,:: 
AuthRoleDto::  +
>::+ ,
(::, -
)::- .
.::. /

ReverseMap::/ 9
(::9 :
)::: ;
;::; <
};; 	
}<< 
}== ∑
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\UserCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class 
UserCreateUpdateDto $
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
?

 
Name

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
? 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
=( )
$num* +
;+ ,
} 
} Ê
hC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\TimeSlotCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class #
TimeSlotCreateUpdateDto (
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
DateTime

 
	StartTime

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
[ 	
Required	 
] 
public 
DateTime 
EndTime 
{  !
get" %
;% &
set' *
;* +
}, -
public 
bool 

IsReserved 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
false/ 4
;4 5
} 
} ª
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\RoleCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class 
RoleCreateUpdateDto $
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
RoleName 
Name 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ¬
fC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\ReviewCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class !
ReviewCreateUpdateDto &
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
int

 
EscapeRoomId

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
[ 	
Required	 
] 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
Rating 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
? 
Content 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

ReviewTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
DateTime3 ;
.; <
Now< ?
;? @
} 
} ˛
hC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\ResourceCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class #
ResourceCreateUpdateDto (
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
?

 
Name

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} —	
kC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\ReservationCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class &
ReservationCreateUpdateDto +
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
int

 
UserId

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
[ 	
Required	 
] 
public 
int 

ResourceId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
	StartTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
EndTime 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} ‚

iC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\PromotionCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class $
PromotionCreateUpdateDto )
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
?

 
Name

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
required 
string 
Code #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
float 
DiscountAmount #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DateTime 
PromotionEndTime (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
int 

UsageCount 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} €
gC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Write\PaymentCreateUpdateDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Write #
{ 
public 

class "
PaymentCreateUpdateDto '
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
PaymentType 
Type 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} ˚
WC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\UserDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
UserDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ‰
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\TimeSlotDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
TimeSlotDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
DateTime 
	StartTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
EndTime 
{  !
get" %
;% &
set' *
;* +
}, -
public 
bool 

IsReserved 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
false/ 4
;4 5
}		 
}

 Ì
WC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\RoleDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
RoleDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
RoleName 
Name 
{ 
get "
;" #
set$ '
;' (
}) *
}		 
}

 ™
YC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\ReviewDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
	ReviewDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
EscapeRoomId 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
int		 
UserId		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
public

 
int

 
Rating

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
public 
string 
? 
Content 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

ReviewTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
EscapeRoomName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} ∞
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\ResourceDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
ResourceDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
}		 ã
^C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\ReservationDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
ReservationDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 

ResourceId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
	StartTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
DateTime		 
EndTime		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
ResourceName "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} î

\C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\PromotionDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 
PromotionDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
required 
string 
Code #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
float 
DiscountAmount #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public		 
DateTime		 
PromotionEndTime		 (
{		) *
get		+ .
;		. /
set		0 3
;		3 4
}		5 6
public

 
int

 

UsageCount

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
} 
} ∏
ZC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Read\PaymentDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Read "
{ 
public 

class 

PaymentDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public		 
PaymentType		 
Type		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
string

 
?

 
UserName

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
} 
} ß
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\RegisterDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
RegisterDto 
{ 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
} 
} 
_C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\RefreshTokenDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
RefreshTokenDto  
{ 
public 
string 
RefreshToken "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ˜
XC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\LoginDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
LoginDto 
{ 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ﬁ
[C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\AuthRoleDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
AuthRoleDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
} 
}		 …

_C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\DTOs\Auth\AuthResponseDto.cs
	namespace 	
ReservationAPI
 
. 
DTOs 
. 
Auth "
{ 
public 

class 
AuthResponseDto  
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 
int		 
RoleId		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
public

 
string

 
RefreshToken

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
=

1 2
string

3 9
.

9 :
Empty

: ?
;

? @
public 
virtual 
AuthRole 
Role  $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
} 
} √G
`C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\UserController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IUserRepository (
_userRepository) 8
;8 9
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserController 
( 
IUserRepository -
userRepository. <
,< =
IMapper> E
mapperF L
)L M
{ 	
_userRepository 
= 
userRepository ,
;, -
_mapper 
= 
mapper 
; 
} 	
[ 	
HttpGet	 
( 
Name 
= 
$str #
)# $
]$ %
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
public 
async 
Task 
< 
IActionResult '
>' (
GetAllUsersAsync) 9
(9 :
): ;
{ 	
var   
users   
=   
await   
_userRepository   -
.  - .
GetAllAsync  . 9
(  9 :
)  : ;
;  ; <
var!! 
userDtos!! 
=!! 
_mapper!! "
.!!" #
Map!!# &
<!!& '
IEnumerable!!' 2
<!!2 3
UserDto!!3 :
>!!: ;
>!!; <
(!!< =
users!!= B
)!!B C
;!!C D
return"" 
Ok"" 
("" 
userDtos"" 
)"" 
;""  
}%% 	
['' 	
HttpGet''	 
('' 
$str'' 
)'' 
]'' 
public(( 
async(( 
Task(( 
<(( 
IActionResult(( '
>((' (
GetUserByIdAsync(() 9
(((9 :
int((: =
id((> @
)((@ A
{)) 	
var** 
user** 
=** 
await** 
_userRepository** ,
.**, -
GetByIdAsync**- 9
(**9 :
id**: <
)**< =
;**= >
if++ 
(++ 
user++ 
==++ 
null++ 
)++ 
return,, 
NotFound,, 
(,,  
),,  !
;,,! "
return-- 
Ok-- 
(-- 
_mapper-- 
.-- 
Map-- !
<--! "
UserDto--" )
>--) *
(--* +
user--+ /
)--/ 0
)--0 1
;--1 2
}.. 	
[00 	
HttpGet00	 
(00 
$str00 
)00 
]00 
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' (
SearchUsersAsync11) 9
(119 :
[11: ;
	FromQuery11; D
]11D E
string11F L
?11L M
name11N R
,11R S
[11T U
	FromQuery11U ^
]11^ _
string11` f
?11f g
email11h m
)11m n
{22 	
var33 
users33 
=33 
await33 
_userRepository33 -
.33- .
	FindAsync33. 7
(337 8
u338 9
=>33: <
(44 
string44 
.44 
IsNullOrEmpty44 %
(44% &
name44& *
)44* +
||44, .
u44/ 0
.440 1
Name441 5
.445 6
Contains446 >
(44> ?
name44? C
,44C D
StringComparison44E U
.44U V
OrdinalIgnoreCase44V g
)44g h
)44h i
&&44j l
(55 
string55 
.55 
IsNullOrEmpty55 %
(55% &
email55& +
)55+ ,
||55- /
u550 1
.551 2
Email552 7
.557 8
Contains558 @
(55@ A
email55A F
,55F G
StringComparison55H X
.55X Y
OrdinalIgnoreCase55Y j
)55j k
)55k l
)66 
;66 
if88 
(88 
!88 
users88 
.88 
Any88 
(88 
)88 
)88 
return99 
NotFound99 
(99  
$str99  G
)99G H
;99H I
return;; 
Ok;; 
(;; 
_mapper;; 
.;; 
Map;; !
<;;! "
IEnumerable;;" -
<;;- .
UserDto;;. 5
>;;5 6
>;;6 7
(;;7 8
users;;8 =
);;= >
);;> ?
;;;? @
}<< 	
[>> 	
HttpPost>>	 
]>> 
public?? 
async?? 
Task?? 
<?? 
IActionResult?? '
>??' (
AddUserAsync??) 5
(??5 6
[??6 7
FromBody??7 ?
]??? @
UserCreateUpdateDto??A T
userDto??U \
)??\ ]
{@@ 	
varAA 
userAA 
=AA 
_mapperAA 
.AA 
MapAA "
<AA" #
UserAA# '
>AA' (
(AA( )
userDtoAA) 0
)AA0 1
;AA1 2
tryBB 
{CC 
awaitDD 
_userRepositoryDD %
.DD% &
AddAsyncDD& .
(DD. /
userDD/ 3
)DD3 4
;DD4 5
}EE 
catchFF 
(FF 
DbUpdateExceptionFF $
exFF% '
)FF' (
{GG 
returnHH 

StatusCodeHH !
(HH! "
$numHH" %
,HH% &
exHH' )
.HH) *
InnerExceptionHH* 8
?HH8 9
.HH9 :
MessageHH: A
??HHB D
exHHE G
.HHG H
MessageHHH O
)HHO P
;HHP Q
}II 
returnJJ 
CreatedAtActionJJ "
(JJ" #
nameofJJ# )
(JJ) *
GetUserByIdAsyncJJ* :
)JJ: ;
.JJ; <
ReplaceJJ< C
(JJC D
$strJJD K
,JJK L
$strJJM O
)JJO P
,JJP Q
newJJR U
{JJV W
idJJX Z
=JJ[ \
userJJ] a
.JJa b
IdJJb d
}JJe f
,JJf g
userDtoJJh o
)JJo p
;JJp q
}KK 	
[MM 	

HttpDeleteMM	 
]MM 
publicNN 
asyncNN 
TaskNN 
<NN 
IActionResultNN '
>NN' (
DeleteUserAsyncNN) 8
(NN8 9
[NN9 :
FromBodyNN: B
]NNB C
UserDtoNND K
userNNL P
)NNP Q
{OO 	
varPP 
entityPP 
=PP 
awaitPP 
_userRepositoryPP .
.PP. /
GetByIdAsyncPP/ ;
(PP; <
userPP< @
.PP@ A
IdPPA C
)PPC D
;PPD E
ifQQ 
(QQ 
entityQQ 
==QQ 
nullQQ 
)QQ 
{RR 
returnSS 
NotFoundSS 
(SS  
)SS  !
;SS! "
}TT 
elseUU 
{VV 
awaitWW 
_userRepositoryWW %
.WW% &
DeleteAsyncWW& 1
(WW1 2
entityWW2 8
)WW8 9
;WW9 :
returnXX 
	NoContentXX  
(XX  !
)XX! "
;XX" #
}YY 
}[[ 	
[]] 	
HttpPut]]	 
]]] 
public^^ 
async^^ 
Task^^ 
<^^ 
IActionResult^^ '
>^^' (
UpdateUserAsync^^) 8
(^^8 9
[^^9 :
FromBody^^: B
]^^B C
UserCreateUpdateDto^^D W
userDto^^X _
)^^_ `
{__ 	
var`` 
entity`` 
=`` 
await`` 
_userRepository`` .
.``. /
GetByIdAsync``/ ;
(``; <
userDto``< C
.``C D
Id``D F
)``F G
;``G H
ifaa 
(aa 
entityaa 
==aa 
nullaa 
)aa 
{bb 
returncc 
NotFoundcc 
(cc  
)cc  !
;cc! "
}dd 
elseee 
{ff 
_mappergg 
.gg 
Mapgg 
(gg 
userDtogg #
,gg# $
entitygg% +
)gg+ ,
;gg, -
awaitii 
_userRepositoryii %
.ii% &
UpdateAsyncii& 1
(ii1 2
entityii2 8
)ii8 9
;ii9 :
returnjj 
Okjj 
(jj 
)jj 
;jj 
}kk 
}ll 	
}oo 
}pp ∞5
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\TimeSlotController.cs
	namespace

 	
ReservationAPI


 
.

 
Controllers

 $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
TimeSlotController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
ITimeSlotRepository ,
timeSlotRepository- ?
;? @
private 
readonly 
IMapper  
mapper! '
;' (
public 
TimeSlotController !
(! "
ITimeSlotRepository" 5
timeSlotRepository6 H
,H I
IMapperJ Q
mapperR X
)X Y
{ 	
this 
. 
timeSlotRepository #
=$ %
timeSlotRepository& 8
;8 9
this 
. 
mapper 
= 
mapper  
;  !
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' ( 
GetAllTimeSlotsAsync) =
(= >
)> ?
{ 	
var 
timeSlotDto 
= 
await #
timeSlotRepository$ 6
.6 7
GetAllAsync7 B
(B C
)C D
;D E
var   
TimeSlotsDtos   
=   
mapper    &
.  & '
Map  ' *
<  * +
IEnumerable  + 6
<  6 7
TimeSlotDto  7 B
>  B C
>  C D
(  D E
timeSlotDto  E P
)  P Q
;  Q R
return!! 
Ok!! 
(!! 
TimeSlotsDtos!! #
)!!# $
;!!$ %
}"" 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' ( 
GetTimeSlotByIdAsync%%) =
(%%= >
int%%> A
id%%B D
)%%D E
{&& 	
var'' 
timeSlot'' 
='' 
await''  
timeSlotRepository''! 3
.''3 4
GetByIdAsync''4 @
(''@ A
id''A C
)''C D
;''D E
var(( 
timeSlotDto(( 
=(( 
mapper(( $
.(($ %
Map((% (
<((( )
TimeSlotDto(() 4
>((4 5
(((5 6
timeSlot((6 >
)((> ?
;((? @
if)) 
()) 
timeSlot)) 
==)) 
null))  
)))  !
return** 
NotFound** 
(**  
)**  !
;**! "
return++ 
Ok++ 
(++ 
timeSlotDto++ !
)++! "
;++" #
},, 	
[.. 	
HttpPost..	 
].. 
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
AddTimeSlotAsync//) 9
(//9 :
[//: ;
FromBody//; C
]//C D#
TimeSlotCreateUpdateDto//E \
timeSlotDto//] h
)//h i
{00 	
var11 
timeSlot11 
=11 
mapper11 !
.11! "
Map11" %
<11% &
TimeSlot11& .
>11. /
(11/ 0
timeSlotDto110 ;
)11; <
;11< =
await22 
timeSlotRepository22 $
.22$ %
AddAsync22% -
(22- .
timeSlot22. 6
)226 7
;227 8
return33 
CreatedAtAction33 "
(33" #
nameof33# )
(33) * 
GetTimeSlotByIdAsync33* >
)33> ?
.33? @
Replace33@ G
(33G H
$str33H O
,33O P
$str33Q S
)33S T
,33T U
new33V Y
{33Z [
id33\ ^
=33_ `
timeSlot33a i
.33i j
Id33j l
}33m n
,33n o
timeSlotDto33p {
)33{ |
;33| }
}44 	
[66 	

HttpDelete66	 
]66 
public77 
async77 
Task77 
<77 
IActionResult77 '
>77' ("
DeleteReservationAsync77) ?
(77? @
[77@ A
FromBody77A I
]77I J
TimeSlotDto77K V
timeSlotDto77W b
)77b c
{88 	
var99 
entity99 
=99 
await99 
timeSlotRepository99 1
.991 2
GetByIdAsync992 >
(99> ?
timeSlotDto99? J
.99J K
Id99K M
)99M N
;99N O
if:: 
(:: 
entity:: 
==:: 
null:: 
):: 
return;; 
NotFound;; 
(;;  
);;  !
;;;! "
else<< 
{== 
await>> 
timeSlotRepository>> (
.>>( )
DeleteAsync>>) 4
(>>4 5
entity>>5 ;
)>>; <
;>>< =
return?? 
	NoContent??  
(??  !
)??! "
;??" #
}@@ 
}AA 	
[CC 	
HttpPutCC	 
]CC 
publicDD 
asyncDD 
TaskDD 
<DD 
IActionResultDD '
>DD' ("
UpdateReservationAsyncDD) ?
(DD? @
[DD@ A
FromBodyDDA I
]DDI J#
TimeSlotCreateUpdateDtoDDK b
timeSlotDtoDDc n
)DDn o
{EE 	
varFF 
entityFF 
=FF 
awaitFF 
timeSlotRepositoryFF 1
.FF1 2
GetByIdAsyncFF2 >
(FF> ?
timeSlotDtoFF? J
.FFJ K
IdFFK M
)FFM N
;FFN O
ifGG 
(GG 
entityGG 
==GG 
nullGG 
)GG 
returnHH 
NotFoundHH 
(HH  
)HH  !
;HH! "
elseII 
{JJ 
mapperKK 
.KK 
MapKK 
(KK 
timeSlotDtoKK &
,KK& '
entityKK( .
)KK. /
;KK/ 0
awaitMM 
timeSlotRepositoryMM (
.MM( )
UpdateAsyncMM) 4
(MM4 5
entityMM5 ;
)MM; <
;MM< =
returnNN 
OkNN 
(NN 
)NN 
;NN 
}OO 
}PP 	
}SS 
}TT ÿP
bC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\ReviewController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ReviewController !
:" #
ControllerBase$ 2
{ 
private 
readonly 
IReviewRepository *
reviewRepository+ ;
;; <
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
TW1DbContext %
_context& .
;. /
public 
ReviewController 
(  
IReviewRepository  1
reviewRepository2 B
,B C
IMapperD K
mapperL R
,R S
TW1DbContextT `
contexta h
)h i
{ 	
this 
. 
reviewRepository !
=" #
reviewRepository$ 4
;4 5
_mapper 
= 
mapper 
; 
_context 
= 
context 
; 
} 	
[!! 	
	Authorize!!	 
(!! 
Roles!! 
=!! 
$str!! "
)!!" #
]!!# $
["" 	
HttpGet""	 
]"" 
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
GetAllReviewsAsync##) ;
(##; <
)##< =
{$$ 	
var%% 
reviews%% 
=%% 
await%% 
reviewRepository%%  0
.%%0 1
GetAllAsync%%1 <
(%%< =
)%%= >
;%%> ?
var&& 

reviewDtos&& 
=&& 
_mapper&& $
.&&$ %
Map&&% (
<&&( )
IEnumerable&&) 4
<&&4 5
	ReviewDto&&5 >
>&&> ?
>&&? @
(&&@ A
reviews&&A H
)&&H I
;&&I J
return'' 
Ok'' 
('' 

reviewDtos''  
)''  !
;''! "
}(( 	
[** 	
HttpGet**	 
(** 
$str** 
)** 
]** 
public++ 
async++ 
Task++ 
<++ 
IActionResult++ '
>++' (
GetReviewByIdAsync++) ;
(++; <
int++< ?
id++@ B
)++B C
{,, 	
var-- 
review-- 
=-- 
await-- 
reviewRepository-- /
.--/ 0
GetByIdAsync--0 <
(--< =
id--= ?
)--? @
;--@ A
if.. 
(.. 
review.. 
==.. 
null.. 
).. 
return// 
NotFound// 
(//  
)//  !
;//! "
return00 
Ok00 
(00 
review00 
)00 
;00 
}11 	
[<< 	
HttpPost<<	 
]<< 
public== 
async== 
Task== 
<== 
IActionResult== '
>==' (
AddReviewAsync==) 7
(==7 8
[==8 9
FromBody==9 A
]==A B!
ReviewCreateUpdateDto==C X
dto==Y \
)==\ ]
{>> 	
var?? 
review?? 
=?? 
_mapper??  
.??  !
Map??! $
<??$ %
Review??% +
>??+ ,
(??, -
dto??- 0
)??0 1
;??1 2
reviewAA 
.AA 
UserAA 
=AA 
awaitAA 
_contextAA  (
.AA( )
	AuthUsersAA) 2
.AA2 3
	FindAsyncAA3 <
(AA< =
dtoAA= @
.AA@ A
UserIdAAA G
)AAG H
;AAH I
reviewBB 
.BB 

EscapeRoomBB 
=BB 
awaitBB  %
_contextBB& .
.BB. /
	ResourcesBB/ 8
.BB8 9
	FindAsyncBB9 B
(BBB C
dtoBBC F
.BBF G
EscapeRoomIdBBG S
)BBS T
;BBT U
ifDD 
(DD 
reviewDD 
.DD 
UserDD 
==DD 
nullDD #
||DD$ &
reviewDD' -
.DD- .

EscapeRoomDD. 8
==DD9 ;
nullDD< @
)DD@ A
{EE 
returnFF 

BadRequestFF !
(FF! "
$strFF" C
)FFC D
;FFD E
}GG 
_contextII 
.II 
ReviewsII 
.II 
AddII  
(II  !
reviewII! '
)II' (
;II( )
awaitJJ 
_contextJJ 
.JJ 
SaveChangesAsyncJJ +
(JJ+ ,
)JJ, -
;JJ- .
varLL 
	reviewDtoLL 
=LL 
_mapperLL #
.LL# $
MapLL$ '
<LL' (
	ReviewDtoLL( 1
>LL1 2
(LL2 3
reviewLL3 9
)LL9 :
;LL: ;
returnMM 
CreatedAtActionMM "
(MM" #
nameofMM# )
(MM) *
GetReviewByIdAsyncMM* <
)MM< =
.MM= >
ReplaceMM> E
(MME F
$strMMF M
,MMM N
$strMMO Q
)MMQ R
,MMR S
newMMT W
{MMX Y
idMMZ \
=MM] ^
reviewMM_ e
.MMe f
IdMMf h
}MMi j
,MMj k
	reviewDtoMMl u
)MMu v
;MMv w
}NN 	
[QQ 	

HttpDeleteQQ	 
]QQ 
publicRR 
asyncRR 
TaskRR 
<RR 
IActionResultRR '
>RR' (
DeleteReviewAsyncRR) :
(RR: ;
[RR; <
FromBodyRR< D
]RRD E
	ReviewDtoRRF O
reviewRRP V
)RRV W
{SS 	
varTT 
entityTT 
=TT 
awaitTT 
reviewRepositoryTT /
.TT/ 0
GetByIdAsyncTT0 <
(TT< =
reviewTT= C
.TTC D
IdTTD F
)TTF G
;TTG H
ifUU 
(UU 
entityUU 
==UU 
nullUU 
)UU 
{VV 
returnWW 
NotFoundWW 
(WW  
)WW  !
;WW! "
}XX 
elseYY 
{ZZ 
await[[ 
reviewRepository[[ &
.[[& '
DeleteAsync[[' 2
([[2 3
entity[[3 9
)[[9 :
;[[: ;
return\\ 
	NoContent\\  
(\\  !
)\\! "
;\\" #
}]] 
}__ 	
[aa 	
HttpPutaa	 
]aa 
publicbb 
asyncbb 
Taskbb 
<bb 
IActionResultbb '
>bb' (
UpdateReviewAsyncbb) :
(bb: ;
[bb; <
FromBodybb< D
]bbD E!
ReviewCreateUpdateDtobbF [
	reviewDtobb\ e
)bbe f
{cc 	
vardd 
entitydd 
=dd 
awaitdd 
reviewRepositorydd /
.dd/ 0
GetByIdAsyncdd0 <
(dd< =
	reviewDtodd= F
.ddF G
IdddG I
)ddI J
;ddJ K
ifee 
(ee 
entityee 
==ee 
nullee 
)ee 
{ff 
returngg 
NotFoundgg 
(gg  
)gg  !
;gg! "
}hh 
elseii 
{jj 
_mapperkk 
.kk 
Mapkk 
(kk 
	reviewDtokk %
,kk% &
entitykk' -
)kk- .
;kk. /
awaitmm 
reviewRepositorymm &
.mm& '
UpdateAsyncmm' 2
(mm2 3
entitymm3 9
)mm9 :
;mm: ;
returnnn 
Oknn 
(nn 
)nn 
;nn 
}oo 
}pp 	
[rr 	
HttpGetrr	 
(rr 
$strrr  
)rr  !
]rr! "
publicss 
asyncss 
Taskss 
<ss 
IActionResultss '
>ss' (
GetUserReviewsAsyncss) <
(ss< =
)ss= >
{tt 	
varuu 
userIdClaimuu 
=uu 
Useruu "
.uu" #
	FindFirstuu# ,
(uu, -

ClaimTypesuu- 7
.uu7 8
NameIdentifieruu8 F
)uuF G
?uuG H
.uuH I
ValueuuI N
;uuN O
ifww 
(ww 
stringww 
.ww 
IsNullOrEmptyww $
(ww$ %
userIdClaimww% 0
)ww0 1
||ww2 4
!ww5 6
intww6 9
.ww9 :
TryParseww: B
(wwB C
userIdClaimwwC N
,wwN O
outwwP S
varwwT W
userIdwwX ^
)ww^ _
)ww_ `
{xx 
returnyy 
Unauthorizedyy #
(yy# $
$stryy$ A
)yyA B
;yyB C
}zz 
var|| 
userReviews|| 
=|| 
await|| #
_context||$ ,
.||, -
Reviews||- 4
.}} 
Where}} 
(}} 
r}} 
=>}} 
r}} 
.}} 
User}} "
.}}" #
Id}}# %
==}}& (
userId}}) /
)}}/ 0
.~~ 
Include~~ 
(~~ 
r~~ 
=>~~ 
r~~ 
.~~  
User~~  $
)~~$ %
. 
Include 
( 
r 
=> 
r 
.  

EscapeRoom  *
)* +
.
ÄÄ 
ToListAsync
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
var
ÇÇ 

reviewDtos
ÇÇ 
=
ÇÇ 
_mapper
ÇÇ $
.
ÇÇ$ %
Map
ÇÇ% (
<
ÇÇ( )
List
ÇÇ) -
<
ÇÇ- .
	ReviewDto
ÇÇ. 7
>
ÇÇ7 8
>
ÇÇ8 9
(
ÇÇ9 :
userReviews
ÇÇ: E
)
ÇÇE F
;
ÇÇF G
return
ÑÑ 
Ok
ÑÑ 
(
ÑÑ 

reviewDtos
ÑÑ  
)
ÑÑ  !
;
ÑÑ! "
}
ÖÖ 	
}
ââ 
}ää õ>
dC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\ResourceController.cs
	namespace

 	
ReservationAPI


 
.

 
Controllers

 $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ResourceController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
IResourceRepository ,
resourceRepository- ?
;? @
private 
readonly 
IMapper  
_mapper! (
;( )
public 
ResourceController !
(! "
IResourceRepository" 5
resourceRepository6 H
,H I
IMapperJ Q
mapperR X
)X Y
{ 	
this 
. 
resourceRepository #
=$ %
resourceRepository& 8
;8 9
_mapper 
= 
mapper 
; 
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' ( 
GetAllResourcesAsync) =
(= >
)> ?
{ 	
var 
	resources 
= 
await !
resourceRepository" 4
.4 5
GetAllAsync5 @
(@ A
)A B
;B C
var   
resourcesDtos   
=   
_mapper    '
.  ' (
Map  ( +
<  + ,
IEnumerable  , 7
<  7 8
ResourceDto  8 C
>  C D
>  D E
(  E F
	resources  F O
)  O P
;  P Q
return!! 
Ok!! 
(!! 
resourcesDtos!! #
)!!# $
;!!$ %
}"" 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' ( 
GetResourceByIdAsync%%) =
(%%= >
int%%> A
id%%B D
)%%D E
{&& 	
var'' 
resource'' 
='' 
await''  
resourceRepository''! 3
.''3 4
GetByIdAsync''4 @
(''@ A
id''A C
)''C D
;''D E
if(( 
((( 
resource(( 
==(( 
null((  
)((  !
return)) 
NotFound)) 
())  
)))  !
;))! "
return** 
Ok** 
(** 
resource** 
)** 
;**  
}++ 	
[-- 	
HttpGet--	 
(-- 
$str-- 
)-- 
]-- 
public.. 
async.. 
Task.. 
<.. 
IActionResult.. '
>..' ( 
SearchResourcesAsync..) =
(..= >
[..> ?
	FromQuery..? H
]..H I
string..J P
?..P Q
name..R V
)..V W
{// 	
var00 
	resources00 
=00 
await00 !
resourceRepository00" 4
.004 5
	FindAsync005 >
(00> ?
r00? @
=>00A C
string00D J
.00J K
IsNullOrEmpty00K X
(00X Y
name00Y ]
)00] ^
||00_ a
r00b c
.00c d
Name00d h
.00h i
Contains00i q
(00q r
name00r v
,00v w
StringComparison	00x à
.
00à â
OrdinalIgnoreCase
00â ö
)
00ö õ
)
00õ ú
;
00ú ù
if22 
(22 
!22 
	resources22 
.22 
Any22 
(22 
)22  
)22  !
return33 
NotFound33 
(33  
$str33  K
)33K L
;33L M
return55 
Ok55 
(55 
	resources55 
)55  
;55  !
}66 	
[88 	
HttpPost88	 
]88 
public99 
async99 
Task99 
<99 
IActionResult99 '
>99' (
AddResourceAsync99) 9
(999 :
[99: ;
FromBody99; C
]99C D#
ResourceCreateUpdateDto99E \
resourceDto99] h
)99h i
{:: 	
var;; 
resource;; 
=;; 
_mapper;; "
.;;" #
Map;;# &
<;;& '
Resource;;' /
>;;/ 0
(;;0 1
resourceDto;;1 <
);;< =
;;;= >
await<< 
resourceRepository<< $
.<<$ %
AddAsync<<% -
(<<- .
resource<<. 6
)<<6 7
;<<7 8
return== 
CreatedAtAction== "
(==" #
nameof==# )
(==) * 
GetResourceByIdAsync==* >
)==> ?
.==? @
Replace==@ G
(==G H
$str==H O
,==O P
$str==P R
)==R S
,==S T
new==U X
{==Y Z
id==[ ]
===^ _
resource==` h
.==h i
Id==i k
}==l m
,==m n
resourceDto==o z
)==z {
;=={ |
}>> 	
[@@ 	

HttpDelete@@	 
]@@ 
publicAA 
asyncAA 
TaskAA 
<AA 
IActionResultAA '
>AA' (
DeleteResourceAsyncAA) <
(AA< =
[AA= >
FromBodyAA> F
]AAF G
ResourceDtoAAH S
resourceAAT \
)AA\ ]
{BB 	
varCC 
entityCC 
=CC 
awaitCC 
resourceRepositoryCC 1
.CC1 2
GetByIdAsyncCC2 >
(CC> ?
resourceCC? G
.CCG H
IdCCH J
)CCJ K
;CCK L
ifDD 
(DD 
entityDD 
==DD 
nullDD 
)DD 
{EE 
returnFF 
NotFoundFF 
(FF  
)FF  !
;FF! "
}GG 
elseHH 
{II 
awaitJJ 
resourceRepositoryJJ (
.JJ( )
DeleteAsyncJJ) 4
(JJ4 5
entityJJ5 ;
)JJ; <
;JJ< =
returnKK 
	NoContentKK  
(KK  !
)KK! "
;KK" #
}LL 
}NN 	
[PP 	
HttpPutPP	 
]PP 
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
IActionResultQQ '
>QQ' (
UpdateResourceAsyncQQ) <
(QQ< =
[QQ= >
FromBodyQQ> F
]QQF G#
ResourceCreateUpdateDtoQQH _
resourceDtoQQ` k
)QQk l
{RR 	
varSS 
entitySS 
=SS 
awaitSS 
resourceRepositorySS 1
.SS1 2
GetByIdAsyncSS2 >
(SS> ?
resourceDtoSS? J
.SSJ K
IdSSK M
)SSM N
;SSN O
ifTT 
(TT 
entityTT 
==TT 
nullTT 
)TT 
{UU 
returnVV 
NotFoundVV 
(VV  
)VV  !
;VV! "
}WW 
elseXX 
{YY 
_mapperZZ 
.ZZ 
MapZZ 
(ZZ 
resourceDtoZZ '
,ZZ' (
entityZZ) /
)ZZ/ 0
;ZZ0 1
await\\ 
resourceRepository\\ (
.\\( )
UpdateAsync\\) 4
(\\4 5
entity\\5 ;
)\\; <
;\\< =
return]] 
Ok]] 
(]] 
)]] 
;]] 
}^^ 
}__ 	
}cc 
}dd ÎW
gC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\ReservationController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class !
ReservationController &
:' (
ControllerBase) 7
{ 
private 
readonly "
IReservationRepository /!
reservationRepository0 E
;E F
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
TW1DbContext %
_context& .
;. /
public !
ReservationController $
($ %"
IReservationRepository% ;!
reservationRepository< Q
,Q R
IMapperS Z
mapper[ a
,a b
TW1DbContextc o
contextp w
)w x
{ 	
this 
. !
reservationRepository &
=' (!
reservationRepository) >
;> ?
_mapper 
= 
mapper 
; 
_context 
= 
context 
; 
} 	
[   	
	Authorize  	 
(   
Roles   
=   
$str   "
)  " #
]  # $
[!! 	
HttpGet!!	 
]!! 
public"" 
async"" 
Task"" 
<"" 
IActionResult"" '
>""' (#
GetAllReservationsAsync"") @
(""@ A
)""A B
{## 	
var$$ 
reservations$$ 
=$$ 
await$$ $!
reservationRepository$$% :
.$$: ;
GetAllAsync$$; F
($$F G
)$$G H
;$$H I
var%% 
reservationsDtos%%  
=%%! "
_mapper%%# *
.%%* +
Map%%+ .
<%%. /
IEnumerable%%/ :
<%%: ;
ReservationDto%%; I
>%%I J
>%%J K
(%%K L
reservations%%L X
)%%X Y
;%%Y Z
return&& 
Ok&& 
(&& 
reservationsDtos&& &
)&&& '
;&&' (
}'' 	
[)) 	
HttpGet))	 
()) 
$str)) 
))) 
])) 
public** 
async** 
Task** 
<** 
IActionResult** '
>**' (#
GetReservationByIdAsync**) @
(**@ A
int**A D
id**E G
)**G H
{++ 	
var,, 
reservation,, 
=,, 
await,, #!
reservationRepository,,$ 9
.,,9 :
GetByIdAsync,,: F
(,,F G
id,,G I
),,I J
;,,J K
var-- 
reservationDto-- 
=--  
_mapper--! (
.--( )
Map--) ,
<--, -
ReservationDto--- ;
>--; <
(--< =
reservation--= H
)--H I
;--I J
if.. 
(.. 
reservation.. 
==.. 
null.. #
)..# $
return// 
NotFound// 
(//  
)//  !
;//! "
return00 
Ok00 
(00 
reservationDto00 $
)00$ %
;00% &
}11 	
[:: 	
HttpPost::	 
]:: 
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
AddReservationAsync;;) <
(;;< =
[;;= >
FromBody;;> F
];;F G&
ReservationCreateUpdateDto;;H b
dto;;c f
);;f g
{<< 	
var== 
reservation== 
=== 
_mapper== %
.==% &
Map==& )
<==) *
Reservation==* 5
>==5 6
(==6 7
dto==7 :
)==: ;
;==; <
reservation?? 
.?? 
User?? 
=?? 
await?? $
_context??% -
.??- .
	AuthUsers??. 7
.??7 8
	FindAsync??8 A
(??A B
dto??B E
.??E F
UserId??F L
)??L M
;??M N
reservation@@ 
.@@ 
Resource@@  
=@@! "
await@@# (
_context@@) 1
.@@1 2
	Resources@@2 ;
.@@; <
	FindAsync@@< E
(@@E F
dto@@F I
.@@I J

ResourceId@@J T
)@@T U
;@@U V
ifBB 
(BB 
reservationBB 
.BB 
UserBB  
==BB! #
nullBB$ (
||BB) +
reservationBB, 7
.BB7 8
ResourceBB8 @
==BBA C
nullBBD H
)BBH I
{CC 
returnDD 

BadRequestDD !
(DD! "
$strDD" A
)DDA B
;DDB C
}EE 
_contextGG 
.GG 
ReservationsGG !
.GG! "
AddGG" %
(GG% &
reservationGG& 1
)GG1 2
;GG2 3
tryHH 
{II 
awaitJJ 
_contextJJ 
.JJ 
SaveChangesAsyncJJ /
(JJ/ 0
)JJ0 1
;JJ1 2
}KK 
catchLL 
(LL 
DbUpdateExceptionLL $
exLL% '
)LL' (
{MM 
returnNN 

StatusCodeNN !
(NN! "
$numNN" %
,NN% &
exNN' )
.NN) *
InnerExceptionNN* 8
?NN8 9
.NN9 :
MessageNN: A
??NNB D
exNNE G
.NNG H
MessageNNH O
)NNO P
;NNP Q
}OO 
varQQ 
resultQQ 
=QQ 
_mapperQQ  
.QQ  !
MapQQ! $
<QQ$ %
ReservationDtoQQ% 3
>QQ3 4
(QQ4 5
reservationQQ5 @
)QQ@ A
;QQA B
returnRR 
CreatedAtActionRR "
(RR" #
nameofRR# )
(RR) *#
GetReservationByIdAsyncRR* A
)RRA B
.RRB C
ReplaceRRC J
(RRJ K
$strRRK R
,RRR S
$strRRT V
)RRV W
,RRW X
newRRY \
{RR] ^
idRR_ a
=RRb c
reservationRRd o
.RRo p
IdRRp r
}RRs t
,RRt u
resultRRv |
)RR| }
;RR} ~
}SS 	
[UU 	

HttpDeleteUU	 
]UU 
publicVV 
asyncVV 
TaskVV 
<VV 
IActionResultVV '
>VV' ("
DeleteReservationAsyncVV) ?
(VV? @
[VV@ A
FromBodyVVA I
]VVI J
ReservationDtoVVK Y
reservationDtoVVZ h
)VVh i
{WW 	
varXX 
entityXX 
=XX 
awaitXX !
reservationRepositoryXX 4
.XX4 5
GetByIdAsyncXX5 A
(XXA B
reservationDtoXXB P
.XXP Q
IdXXQ S
)XXS T
;XXT U
ifYY 
(YY 
entityYY 
==YY 
nullYY 
)YY 
returnZZ 
NotFoundZZ 
(ZZ  
)ZZ  !
;ZZ! "
else[[ 
{\\ 
await]] !
reservationRepository]] +
.]]+ ,
DeleteAsync]], 7
(]]7 8
entity]]8 >
)]]> ?
;]]? @
return^^ 
	NoContent^^  
(^^  !
)^^! "
;^^" #
}__ 
}`` 	
[bb 	
HttpPutbb	 
]bb 
publiccc 
asynccc 
Taskcc 
<cc 
IActionResultcc '
>cc' ("
UpdateReservationAsynccc) ?
(cc? @
[cc@ A
FromBodyccA I
]ccI J&
ReservationCreateUpdateDtoccJ d
reservationDtocce s
)ccs t
{dd 	
varee 
entityee 
=ee 
awaitee !
reservationRepositoryee 4
.ee4 5
GetByIdAsyncee5 A
(eeA B
reservationDtoeeB P
.eeP Q
IdeeQ S
)eeS T
;eeT U
ifff 
(ff 
entityff 
==ff 
nullff 
)ff 
returngg 
NotFoundgg 
(gg  
)gg  !
;gg! "
elsehh 
{ii 
_mapperjj 
.jj 
Mapjj 
(jj 
reservationDtojj *
,jj* +
entityjj, 2
)jj2 3
;jj3 4
awaitll !
reservationRepositoryll +
.ll+ ,
UpdateAsyncll, 7
(ll7 8
entityll8 >
)ll> ?
;ll? @
returnmm 
Okmm 
(mm 
reservationDtomm (
)mm( )
;mm) *
}nn 
}oo 	
[qq 	
HttpGetqq	 
(qq 
$strqq &
)qq& '
]qq' (
publicrr 
asyncrr 
Taskrr 
<rr 
IActionResultrr '
>rr' ($
GetUserReservationsAsyncrr) A
(rrA B
)rrB C
{ss 	
vartt 
userIdClaimtt 
=tt 
Usertt "
.tt" #
	FindFirsttt# ,
(tt, -

ClaimTypestt- 7
.tt7 8
NameIdentifiertt8 F
)ttF G
?ttG H
.ttH I
ValuettI N
;ttN O
ifvv 
(vv 
stringvv 
.vv 
IsNullOrEmptyvv $
(vv$ %
userIdClaimvv% 0
)vv0 1
||vv2 4
!vv5 6
intvv6 9
.vv9 :
TryParsevv: B
(vvB C
userIdClaimvvC N
,vvN O
outvvP S
varvvT W
userIdvvX ^
)vv^ _
)vv_ `
{ww 
returnxx 
Unauthorizedxx #
(xx# $
$strxx$ A
)xxA B
;xxB C
}yy 
var{{ 
userReservations{{  
={{! "
await{{# (
_context{{) 1
.{{1 2
Reservations{{2 >
.|| 
Where|| 
(|| 
r|| 
=>|| 
r|| 
.|| 
UserId|| $
==||% '
userId||( .
)||. /
.}} 
Include}} 
(}} 
r}} 
=>}} 
r}} 
.}}  
User}}  $
)}}$ %
.~~ 
Include~~ 
(~~ 
r~~ 
=>~~ 
r~~ 
.~~  
Resource~~  (
)~~( )
. 
ToListAsync 
( 
) 
; 
var
ÅÅ 
reservationDtos
ÅÅ 
=
ÅÅ  !
_mapper
ÅÅ" )
.
ÅÅ) *
Map
ÅÅ* -
<
ÅÅ- .
List
ÅÅ. 2
<
ÅÅ2 3
ReservationDto
ÅÅ3 A
>
ÅÅA B
>
ÅÅB C
(
ÅÅC D
userReservations
ÅÅD T
)
ÅÅT U
;
ÅÅU V
return
ÉÉ 
Ok
ÉÉ 
(
ÉÉ 
reservationDtos
ÉÉ %
)
ÉÉ% &
;
ÉÉ& '
}
ÑÑ 	
}
áá 
}àà Û5
eC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\PromotionController.cs
	namespace

 	
ReservationAPI


 
.

 
Controllers

 $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
PromotionController $
:% &
ControllerBase' 5
{ 
private 
readonly  
IPromotionRepository -
promotionRepository. A
;A B
private 
readonly 
IMapper  
mapper! '
;' (
public 
PromotionController "
(" # 
IPromotionRepository# 7
promotionRepository8 K
,K L
IMapperM T
mapperU [
)[ \
{ 	
this 
. 
promotionRepository $
=% &
promotionRepository' :
;: ;
this 
. 
mapper 
= 
mapper  
;  !
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (!
GetAllPromotionsAsync) >
(> ?
)? @
{ 	
var 
reservations 
= 
await $
promotionRepository% 8
.8 9
GetAllAsync9 D
(D E
)E F
;F G
var   
reservationsDtos    
=  ! "
mapper  # )
.  ) *
Map  * -
<  - .
IEnumerable  . 9
<  9 :
PromotionDto  : F
>  F G
>  G H
(  H I
reservations  I U
)  U V
;  V W
return!! 
Ok!! 
(!! 
reservationsDtos!! &
)!!& '
;!!' (
}"" 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' (#
GetReservationByIdAsync%%) @
(%%@ A
int%%A D
id%%E G
)%%G H
{&& 	
var'' 
reservation'' 
='' 
await'' #
promotionRepository''$ 7
.''7 8
GetByIdAsync''8 D
(''D E
id''E G
)''G H
;''H I
var(( 
reservationDto(( 
=((  
mapper((! '
.((' (
Map((( +
<((+ ,
PromotionDto((, 8
>((8 9
(((9 :
reservation((: E
)((E F
;((F G
if)) 
()) 
reservation)) 
==)) 
null)) #
)))# $
return** 
NotFound** 
(**  
)**  !
;**! "
return++ 
Ok++ 
(++ 
reservationDto++ $
)++$ %
;++% &
},, 	
[.. 	
HttpPost..	 
].. 
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
AddReservationAsync//) <
(//< =
[//= >
FromBody//> F
]//F G$
PromotionCreateUpdateDto//H `
promotionDto//a m
)//m n
{00 	
var11 
	promotion11 
=11 
mapper11 "
.11" #
Map11# &
<11& '
	Promotion11' 0
>110 1
(111 2
promotionDto112 >
)11> ?
;11? @
await22 
promotionRepository22 %
.22% &
AddAsync22& .
(22. /
	promotion22/ 8
)228 9
;229 :
return33 
CreatedAtAction33 "
(33" #
nameof33# )
(33) *#
GetReservationByIdAsync33* A
)33A B
.33B C
Replace33C J
(33J K
$str33K R
,33R S
$str33S U
)33U V
,33V W
new33X [
{33\ ]
id33] _
=33` a
	promotion33c l
.33l m
Id33m o
}33o p
,33p q
promotionDto33r ~
)33~ 
;	33 Ä
}44 	
[66 	

HttpDelete66	 
]66 
public77 
async77 
Task77 
<77 
IActionResult77 '
>77' ("
DeleteReservationAsync77) ?
(77? @
[77@ A
FromBody77A I
]77I J
PromotionDto77K W
promotionDto77X d
)77d e
{88 	
var99 
entity99 
=99 
await99 
promotionRepository99 2
.992 3
GetByIdAsync993 ?
(99? @
promotionDto99@ L
.99L M
Id99M O
)99O P
;99P Q
if:: 
(:: 
entity:: 
==:: 
null:: 
):: 
return;; 
NotFound;; 
(;;  
);;  !
;;;! "
else<< 
{== 
await>> 
promotionRepository>> )
.>>) *
DeleteAsync>>* 5
(>>5 6
entity>>6 <
)>>< =
;>>= >
return?? 
	NoContent??  
(??  !
)??! "
;??" #
}@@ 
}AA 	
[CC 	
HttpPutCC	 
]CC 
publicDD 
asyncDD 
TaskDD 
<DD 
IActionResultDD '
>DD' ("
UpdateReservationAsyncDD) ?
(DD? @
[DD@ A
FromBodyDDA I
]DDI J$
PromotionCreateUpdateDtoDDK c
promotionDtoDDd p
)DDp q
{EE 	
varFF 
entityFF 
=FF 
awaitFF 
promotionRepositoryFF 2
.FF2 3
GetByIdAsyncFF3 ?
(FF? @
promotionDtoFF@ L
.FFL M
IdFFM O
)FFO P
;FFP Q
ifGG 
(GG 
entityGG 
==GG 
nullGG 
)GG 
returnHH 
NotFoundHH 
(HH  
)HH  !
;HH! "
elseII 
{JJ 
mapperKK 
.KK 
MapKK 
(KK 
promotionDtoKK '
,KK' (
entityKK) /
)KK/ 0
;KK0 1
awaitMM 
promotionRepositoryMM )
.MM) *
UpdateAsyncMM* 5
(MM5 6
entityMM6 <
)MM< =
;MM= >
returnNN 
OkNN 
(NN 
)NN 
;NN 
}OO 
}PP 	
}SS 
}TT ñ<
cC:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\PaymentController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
PaymentController "
:# $
ControllerBase% 3
{ 
private 
readonly 
TW1DbContext %
context& -
;- .
private 
readonly 
IPaymentRepository +
paymentRepository, =
;= >
private 
readonly 
IMapper  
_mapper! (
;( )
public 
PaymentController  
(  !
IPaymentRepository! 3
paymentRepository4 E
,E F
IMapperG N
mapperO U
,U V
TW1DbContextW c
contextd k
)k l
{ 	
this 
. 
paymentRepository "
=# $
paymentRepository% 6
;6 7
_mapper 
= 
mapper 
; 
this 
. 
context 
= 
context "
;" #
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[   	
HttpGet  	 
]   
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
GetAllPaymentsAsync!!) <
(!!< =
)!!= >
{"" 	
var## 
payments## 
=## 
await##  
paymentRepository##! 2
.##2 3
GetAllAsync##3 >
(##> ?
)##? @
;##@ A
var$$ 
paymentDtos$$ 
=$$ 
_mapper$$ %
.$$% &
Map$$& )
<$$) *
IEnumerable$$* 5
<$$5 6

PaymentDto$$6 @
>$$@ A
>$$A B
($$B C
payments$$C K
)$$K L
;$$L M
return%% 
Ok%% 
(%% 
paymentDtos%% !
)%%! "
;%%" #
}&& 	
[(( 	
HttpGet((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
GetPaymentByIdAsync))) <
())< =
int))= @
id))A C
)))C D
{** 	
var++ 
payment++ 
=++ 
await++ 
paymentRepository++  1
.++1 2
GetByIdAsync++2 >
(++> ?
id++? A
)++A B
;++B C
if,, 
(,, 
payment,, 
==,, 
null,, 
),,  
return-- 
NotFound-- 
(--  
)--  !
;--! "
return.. 
Ok.. 
(.. 
payment.. 
).. 
;.. 
}// 	
[11 	
HttpPost11	 
]11 
public22 
async22 
Task22 
<22 
IActionResult22 '
>22' (
AddPaymentAsync22) 8
(228 9
[229 :
FromBody22: B
]22B C"
PaymentCreateUpdateDto22D Z

paymentDto22[ e
)22e f
{33 	
var44 
payment44 
=44 
_mapper44 !
.44! "
Map44" %
<44% &
Payment44& -
>44- .
(44. /

paymentDto44/ 9
)449 :
;44: ;
try55 
{66 
await77 
paymentRepository77 '
.77' (
AddAsync77( 0
(770 1
payment771 8
)778 9
;779 :
}88 
catch99 
(99 
DbUpdateException99 $
ex99% '
)99' (
{:: 
return;; 

StatusCode;; !
(;;! "
$num;;" %
,;;% &
ex;;' )
.;;) *
InnerException;;* 8
?;;8 9
.;;9 :
Message;;: A
??;;B D
ex;;E G
.;;G H
Message;;H O
);;O P
;;;P Q
}<< 
await== 
context== 
.== 
SaveChangesAsync== *
(==* +
)==+ ,
;==, -
return>> 
CreatedAtAction>> "
(>>" #
nameof>># )
(>>) *
GetPaymentByIdAsync>>* =
)>>= >
.>>> ?
Replace>>? F
(>>F G
$str>>G N
,>>N O
$str>>O Q
)>>Q R
,>>R S
new>>T W
{>>X Y
id>>Z \
=>>] ^
payment>>_ f
.>>f g
Id>>g i
}>>j k
,>>k l

paymentDto>>m w
)>>w x
;>>x y
}?? 	
[AA 	

HttpDeleteAA	 
]AA 
publicBB 
asyncBB 
TaskBB 
<BB 
IActionResultBB '
>BB' (
DeletePaymentAsyncBB) ;
(BB; <
[BB< =
FromBodyBB= E
]BBE F

PaymentDtoBBG Q
paymentBBR Y
)BBY Z
{CC 	
varDD 
entityDD 
=DD 
awaitDD 
paymentRepositoryDD 0
.DD0 1
GetByIdAsyncDD1 =
(DD= >
paymentDD> E
.DDE F
IdDDF H
)DDH I
;DDI J
ifEE 
(EE 
entityEE 
==EE 
nullEE 
)EE 
{FF 
returnGG 
NotFoundGG 
(GG  
)GG  !
;GG! "
}HH 
elseII 
{JJ 
awaitKK 
paymentRepositoryKK '
.KK' (
DeleteAsyncKK( 3
(KK3 4
entityKK4 :
)KK: ;
;KK; <
awaitLL 
contextLL 
.LL 
SaveChangesAsyncLL .
(LL. /
)LL/ 0
;LL0 1
returnMM 
	NoContentMM  
(MM  !
)MM! "
;MM" #
}NN 
}OO 	
[QQ 	
HttpPutQQ	 
]QQ 
publicRR 
asyncRR 
TaskRR 
<RR 
IActionResultRR '
>RR' (
UpdatePaymentAsyncRR) ;
(RR; <
[RR< =
FromBodyRR= E
]RRE F"
PaymentCreateUpdateDtoRRG ]

paymentDtoRR^ h
)RRh i
{SS 	
varTT 
entityTT 
=TT 
awaitTT 
paymentRepositoryTT 0
.TT0 1
GetByIdAsyncTT1 =
(TT= >

paymentDtoTT> H
.TTH I
IdTTI K
)TTK L
;TTL M
ifUU 
(UU 
entityUU 
==UU 
nullUU 
)UU 
{VV 
returnWW 
NotFoundWW 
(WW  
)WW  !
;WW! "
}XX 
elseYY 
{ZZ 
_mapper[[ 
.[[ 
Map[[ 
([[ 

paymentDto[[ &
,[[& '
entity[[' -
)[[- .
;[[. /
await]] 
paymentRepository]] '
.]]' (
UpdateAsync]]( 3
(]]3 4
entity]]4 :
)]]: ;
;]]; <
await^^ 
context^^ 
.^^ 
SaveChangesAsync^^ .
(^^. /
)^^/ 0
;^^0 1
return__ 
Ok__ 
(__ 
)__ 
;__ 
}`` 
}aa 	
}dd 
}ee áC
`C:\Users\janha\source\repos\TehnologijeWeba1Projekt\ReservationAPI\Controllers\AuthController.cs
	namespace 	
ReservationAPI
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly 
TW1DbContext %
context& -
;- .
private 
readonly 
AuthService $

jwtService% /
;/ 0
private 
readonly 
IMapper  
_mapper! (
;( )
public 
AuthController 
( 
TW1DbContext *
context+ 2
,2 3
AuthService4 ?

jwtService@ J
,J K
IMapperL S
mapperT Z
)Z [
{ 	
this 
. 
context 
= 
context "
;" #
this 
. 

jwtService 
= 

jwtService (
;( )
_mapper 
= 
mapper 
; 
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
RegisterAsync) 6
(6 7
RegisterDto7 B
dtoC F
)F G
{   	
var!! 
Register!! 
=!! 
_mapper!! "
.!!" #
Map!!# &
<!!& '
AuthUser!!' /
>!!/ 0
(!!0 1
dto!!1 4
)!!4 5
;!!5 6
Register"" 
."" 
PasswordHash"" !
=""" #
BCrypt""$ *
.""* +
Net""+ .
."". /
BCrypt""/ 5
.""5 6
HashPassword""6 B
(""B C
dto""C F
.""F G
Password""G O
)""O P
;""P Q
Register## 
.## 
Role## 
=## 
await## !
context##" )
.##) *
	AuthRoles##* 3
.##3 4
	FindAsync##4 =
(##= >
dto##> A
.##A B
RoleId##B H
)##H I
;##I J
await%% 
context%% 
.%% 
	AuthUsers%% #
.%%# $
AddAsync%%$ ,
(%%, -
Register%%- 5
)%%5 6
;%%6 7
try&& 
{'' 
await(( 
context(( 
.(( 
SaveChangesAsync(( .
(((. /
)((/ 0
;((0 1
})) 
catch** 
(** 
DbUpdateException** $
ex**% '
)**' (
{++ 
return,, 

StatusCode,, !
(,,! "
$num,," %
,,,% &
ex,,' )
.,,) *
InnerException,,* 8
?,,8 9
.,,9 :
Message,,: A
??,,B D
ex,,E G
.,,G H
Message,,H O
),,O P
;,,P Q
}-- 
return.. 
Ok.. 
(.. 
Register.. 
).. 
;..  
}// 	
[11 	
HttpPost11	 
(11 
$str11 
)11 
]11 
public22 
async22 
Task22 
<22 
IActionResult22 '
>22' (

LoginAsync22) 3
(223 4
LoginDto224 <
dto22= @
)22@ A
{33 	
var44 
user44 
=44 
await44 
context44 $
.44$ %
	AuthUsers44% .
.55 
Include55 
(55 
u55 
=>55 
u55 
.55  
Role55  $
)55$ %
.66 
FirstOrDefaultAsync66 $
(66$ %
u66% &
=>66' )
u66* +
.66+ ,
Email66, 1
==662 4
dto665 8
.668 9
Email669 >
)66> ?
;66? @
if77 
(77 
user77 
==77 
null77 
||77 
!77  !
BCrypt77! '
.77' (
Net77( +
.77+ ,
BCrypt77, 2
.772 3
Verify773 9
(779 :
dto77: =
.77= >
Password77> F
,77F G
user77H L
.77L M
PasswordHash77M Y
)77Y Z
)77Z [
return88 
Unauthorized88 #
(88# $
$str88$ 9
)889 :
;88: ;
var:: 
token:: 
=:: 

jwtService:: "
.::" #
GenerateJwtToken::# 3
(::3 4
user::4 8
)::8 9
;::9 :
var;; 
refreshToken;; 
=;; 

jwtService;; )
.;;) * 
GenerateRefreshToken;;* >
(;;> ?
user;;? C
);;C D
;;;D E
return== 
Ok== 
(== 
new== 
{== 
token>> 
,>> 
refreshToken?? 
,?? 
}AA 
)AA 
;AA 
}BB 	
[DD 	
HttpPostDD	 
(DD 
$strDD 
)DD 
]DD 
publicEE 
asyncEE 
TaskEE 
<EE 
IActionResultEE '
>EE' (
RefreshAsyncEE) 5
(EE5 6
RefreshTokenDtoEE6 E
dtoEEF I
)EEI J
{FF 	
varGG 
userGG 
=GG 
awaitGG 
contextGG $
.GG$ %
	AuthUsersGG% .
.HH 
IncludeHH 
(HH 
uHH 
=>HH 
uHH 
.HH  
RoleHH  $
)HH$ %
.II 
FirstOrDefaultAsyncII $
(II$ %
uII% &
=>II' )
uII* +
.II+ ,
RefreshTokenII, 8
==II9 ;
dtoII< ?
.II? @
RefreshTokenII@ L
)IIL M
;IIM N
ifKK 
(KK 
userKK 
==KK 
nullKK 
)KK 
returnLL 
UnauthorizedLL #
(LL# $
$strLL$ ;
)LL; <
;LL< =
varNN 
tokenNN 
=NN 

jwtServiceNN "
.NN" #
GenerateJwtTokenNN# 3
(NN3 4
userNN4 8
)NN8 9
;NN9 :
varOO 
refreshTokenOO 
=OO 

jwtServiceOO )
.OO) * 
GenerateRefreshTokenOO* >
(OO> ?
userOO? C
)OOC D
;OOD E
returnQQ 
OkQQ 
(QQ 
newQQ 
{QQ 
tokenQQ !
,QQ! "
refreshTokenQQ# /
}QQ0 1
)QQ1 2
;QQ2 3
}RR 	
[SS 	
	AuthorizeSS	 
(SS 
RolesSS 
=SS 
$strSS "
)SS" #
]SS# $
[TT 	
HttpPostTT	 
(TT 
$strTT 
)TT 
]TT 
publicUU 
asyncUU 
TaskUU 
<UU 
IActionResultUU '
>UU' (
AddRoleUU) 0
(UU0 1
AuthRoleDtoUU1 <
dtoUU= @
)UU@ A
{VV 	
varWW 
roleWW 
=WW 
_mapperWW 
.WW 
MapWW "
<WW" #
AuthRoleWW# +
>WW+ ,
(WW, -
dtoWW- 0
)WW0 1
;WW1 2
awaitXX 
contextXX 
.XX 
	AuthRolesXX #
.XX# $
AddAsyncXX$ ,
(XX, -
roleXX- 1
)XX1 2
;XX2 3
tryYY 
{ZZ 
await[[ 
context[[ 
.[[ 
SaveChangesAsync[[ .
([[. /
)[[/ 0
;[[0 1
}\\ 
catch]] 
(]] 
DbUpdateException]] $
ex]]% '
)]]' (
{^^ 
return__ 

StatusCode__ !
(__! "
$num__" %
,__% &
ex__' )
.__) *
InnerException__* 8
?__8 9
.__9 :
Message__: A
??__B D
ex__E G
.__G H
Message__H O
)__O P
;__P Q
}`` 
returnaa 
Okaa 
(aa 
roleaa 
)aa 
;aa 
}bb 	
}cc 
}dd 